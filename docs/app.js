"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}!function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e){i.d(a,n,function(t){return e[t]}.bind(null,n))}return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t){var i="http://www.w3.org/2000/svg";yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",function(){var e=document.querySelector("svg#scene");var t=new n(e,[{gradient:[1,0],delta:[0,0],width:20,color:"black"},{gradient:[1,0],delta:[20,0],width:20,rail:[1,1/4]},{gradient:[1,1],delta:[27,13],width:20,rail:[1,1/4]},{gradient:[0,1],delta:[13,27],width:20,rail:[1,1/4]},{gradient:[-1,1],delta:[-13,27],width:20,rail:[1,1/4]},{gradient:[-1,0],delta:[-27,13],width:20,rail:[1,1/4],color:"lightgreen"},{gradient:[-1,0],delta:[-120,0],width:20,rail:[1,1/4]},{gradient:[-1,-1],delta:[-27,-13],width:20,rail:[1,1/4]},{gradient:[0,-1],delta:[-13,-27],width:20,rail:[1,1/4]},{gradient:[1,-1],delta:[13,-27],width:20,rail:[1,1/4]},{gradient:[1,0],delta:[27,-13],width:20,rail:[1,1/4]}].map(function(e){return new a(e)}),[new r("Alice",{color:"lightgreen",color2:"orange",rgb:[144,238,144]}),new r("Brooklyn",{color:"white",color2:"black",r:3,strokeWidth:3,rgb:[68,68,68]}),new r("Charlotte",{color:"#249E57",color2:"lightgrey",r:3.5,strokeWidth:2,rgb:[36,158,87]}),new r("Dallas",{color:"white",color2:"blue",r:3,strokeWidth:3,rgb:[0,0,255]}),new r("Edison",{color:"lightblue",color2:"cornflowerblue",r:3.5,strokeWidth:2,rgb:[173,216,230]}),new r("Florence",{color:"#1E3258",color2:"#BF1F2D",r:3.5,strokeWidth:2,rgb:[191,31,45]})],{laps:3});t.simulation.stop(),t.init(),s(t),document.getElementById("btnStart").focus(),document.getElementById("btnStart").addEventListener("click",function(e){switch(e.preventDefault(),e.currentTarget.innerText){case"Start":console.log("Sam, start!"),t.simulation.stop(),t.init(),t.simulation.alpha(1),setTimeout(function(e){t.simulation.restart(),e.innerText="Pause",e.disabled=!1,e.focus()},500,e.currentTarget),e.currentTarget.disabled=!0;break;case"Pause":t.simulation.stop(),e.currentTarget.innerText="Play";break;case"Play":t.simulation.restart(),e.currentTarget.innerText="Pause";}}),document.getElementById("btnTick").addEventListener("click",function(e){e.preventDefault(),t.simulation.tick(),t.onTick()}),document.querySelector("input[type=\"file\"]").addEventListener("change",function(i){var a=i.target.files[0];if("application/json"!==a.type)return void i.preventDefault();var r=new FileReader;r.onload=function(i){var a=JSON.parse(i.target.result);t=n.fromJson(a,e),t.simulation.stop(),s(t)},r.readAsText(a)})});function a(e){var _this=this;Object.assign(this,{gradient:[1,0],delta:[0,0],width:20,rail:[.5,.5]},e);var t=Math.hypot.apply(Math,_toConsumableArray(this.gradient));var i=Math.acos(this.gradient[0]/t);this.gradient[1]<0&&(i=2*Math.PI-i),this.α=i,this.force=function(){var e=[];var t=_this;function i(i){e.forEach(function(e){if(0===e.trackAhead.length)return;if(e.trackAhead[0]!==t)return;var a=[t.gradient[0]-e.vx,t.gradient[1]-e.vy];0!==Math.hypot(e.vx,e.vy)&&Math.acos((a[0]*e.vx+a[1]*e.vy)/Math.hypot.apply(Math,_toConsumableArray(a))/Math.hypot(e.vx,e.vy))>Math.PI/2&&(a=[0,0]),a=a.map(function(e,i){return e+t.gradient[i]});var n=Math.hypot.apply(Math,_toConsumableArray(a));a=a.map(function(e){return e/n}),e.vx+=.1*a[0]*i,e.vy+=.1*a[1]*i;var r=[e.x+e.vx,e.y+e.vy];if(Number.isFinite(t.m)&&Number.isFinite(t.b)&&0!==t.α&&t.α!==Math.PI&&t.α!==2*Math.PI){var _i=t.m*r[0]+t.b;t.α>0&&t.α<Math.PI&&_i<=r[1]&&(e.nextPiece=!0),t.α>Math.PI&&_i>=r[1]&&(e.nextPiece=!0)}else 0===t.α&&t.x<r[0]&&(e.nextPiece=!0),t.α===Math.PI&&t.x>r[0]&&(e.nextPiece=!0);var s=e.trackAhead.slice(-1).pop();if(Number.isFinite(s.m)&&Number.isFinite(s.b)&&0!==s.α&&s.α!==Math.PI&&s.α!==2*Math.PI){var _t=s.m*e.x+s.b;s.α>0&&s.α<Math.PI&&_t>e.y&&(e.previousPiece=!0),s.α>Math.PI&&_t<e.y&&(e.previousPiece=!0)}else 0===s.α&&s.x>e.x&&(e.previousPiece=!0),s.α===Math.PI&&s.x<e.x&&(e.previousPiece=!0);e.previousPiece&&(e.nextPiece=!1)})}return i.initialize=function(t){e=t},i}()}function n(e,t,a){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var r=d3.forceSimulation();Object.assign(this,{laps:10},n,{gradients:[],rails:[],tick:0,time:0,finalStanding:[]});var s=document.createElementNS(i,"g");s.setAttribute("id","gTrack");var o=document.createElementNS(i,"g");o.setAttribute("id","gCars"),e instanceof SVGElement&&(e.appendChild(s),e.appendChild(o)),Object.defineProperties(this,{simulation:{get:function get(){return r}},svg:{get:function get(){return e}},gTrack:{get:function get(){return s}},gCars:{get:function get(){return o}}}),t instanceof Array&&this.setTrack(t),a instanceof Array&&this.setCars(a)}function r(e){var _this2=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Object.assign(this,{strokeWidth:1,r:4},t,{trackAhead:[],nextPiece:!1,previousPiece:!1,lapTimes:[],time:[],pos:[]}),Object.defineProperties(this,{name:{enumerable:!0,get:function get(){return e}},radius:{enumerable:!0,get:function get(){return _this2.r+_this2.strokeWidth/2}}})}function s(e){console.log("Sam, let's do this!");var _BABYLON=BABYLON,t=_BABYLON.Animation,i=_BABYLON.Color3,a=_BABYLON.Color4,n=_BABYLON.DirectionalLight,r=_BABYLON.Engine,s=_BABYLON.Mesh,o=_BABYLON.MeshBuilder,l=_BABYLON.Scene,c=_BABYLON.SkyMaterial,h=_BABYLON.StandardMaterial,d=_BABYLON.Texture,m=_BABYLON.UniversalCamera,u=_BABYLON.Vector3,p=new r(document.querySelector("canvas#replay"),!0),g=new l(p);g.useRightHandedSystem=!0,g.ambientColor=new i(.7,.7,.7);var f=new c("sky",g);f.backFaceCulling=!1,f.luminance=.1,f.useSunPosition=!0,f.sunPosition=new u(10,3,0),f.turbidity=2,f.rayleigh=3,f.cameraOffset.y=200,s.CreateBox("skyBox",1e3,g).material=f;var y=new n("light2",f.sunPosition.negate(),g);y.diffuse=new i(.8,.8,.8),y.intensity=.5;var x=[new m("universalCamera1",new u(-35,160,2*e.extrema[1][1]),g),new m("universalCamera2",new u(e.extrema[0][1]+10,20,e.extrema[1][0]-10),g),new m("universalCamera3",new u(e.extrema[0][0]-10,20,e.extrema[1][0]-10),g)];var v=e.extrema[0][1]-e.extrema[0][0]+20,w=e.extrema[1][1]-e.extrema[1][0]+20;w>4*v/5?v=5*w/4:w=4*v/5;var b=o.CreateGround("ground1",{height:w,width:v,subdivisions:2},g);b.position=new u((e.extrema[0][1]+e.extrema[0][0])/2,-.02,(e.extrema[1][1]+e.extrema[1][0])/2);var M=new h("grass",g);M.diffuseColor=new i(86/255,125/255,70/255),M.ambientColor=new i(86/255,125/255,70/255),b.material=M;var P=new h("asphalt",g);P.diffuseColor=new i(183/255,181/255,186/255),P.ambientColor=new i(183/255,181/255,186/255);var k=new h("black",g);k.diffuseColor=new i(1/255,1/255,1/255),k.ambientColor=new i(1/255,1/255,1/255);var C=new h("siding",g);C.diffuseColor=new i(235/255,88/255,99/255),C.ambientColor=new i(235/255,88/255,99/255);var T=[[],[]],E=[[],[]];e.rails.forEach(function(e,t){var i=e.getTotalLength();for(var _a=0;_a<100;_a+=1){var _n=e.getPointAtLength(i*_a/100);T[t].push(new u(_n.x,0,_n.y)),E[t].push(new u(_n.x,5,_n.y))}}),E.forEach(function(e,t){for(var _i2=0;_i2<2;_i2++){var _a2=[e,T[t]];_i2%2&&_a2.reverse(),o.CreateRibbon("rail".concat(t).concat(_i2),{pathArray:_a2,closePath:!0},g).material=C}}),o.CreateRibbon("track",{pathArray:T.reverse(),closePath:!0},g).material=P;var A=e.gradients[0];o.CreateLines("startLine",{points:[new u(A.x-A.width*Math.sin(A.α),.02,A.y+A.width*Math.cos(A.α)),new u(A.x+A.width*Math.sin(A.α),.02,A.y-A.width*Math.cos(A.α))],colors:new Array(2).fill(new a(0,0,0,1)),useVertexAlpha:!1},g).material=k;var S=e.cars.slice();if(S.forEach(function(e){var t=e.pos[0];if(e.sphere=o.CreateSphere("sphere",{segments:16,diameter:2*e.radius},g),e.sphere.position=new u(t.x,e.radius,t.y),e.rgb instanceof Array){var _t2=new h("".concat(e.name,"Material"),g);_t2.diffuseColor=_construct(i,_toConsumableArray(e.rgb.map(function(e){return e/255}))),_t2.ambientColor=_construct(i,_toConsumableArray(e.rgb.map(function(e){return e/255}))),_t2.diffuseTexture=new d("ball.png",g),e.sphere.material=_t2}}),S[0].pos.length>1){console.log("Sam, cars:",S);var _e=3,_i3=2*Math.PI;Math.PI;S.forEach(function(a,n){var r=0,s=0;var o=[],l=[],c=new t("moveAnime".concat(a.name),"position",60,t.ANIMATIONTYPE_VECTOR3,t.ANIMATIONLOOPMODE_CYCLE),h=new t("spinAnime".concat(a.name),"rotation",60,t.ANIMATIONTYPE_VECTOR3,t.ANIMATIONLOOPMODE_CYCLE);a.pos.forEach(function(t){o.push({frame:t.tick*_e,value:new u(t.x,a.radius,t.y)});var n=Math.hypot(t.vx,t.vy);if(n>0){var _e2=-Math.sign(t.vy)*Math.acos(t.vx/n)%_i3-s%_i3;for(;Math.abs(_e2)>Math.PI;){_e2-=Math.sign(_e2)*_i3}s+=_e2,r-=n*Math.PI/16}l.push({frame:t.tick*_e,value:new u(0,s,r)})}),o.push({frame:o[o.length-1].frame+120,value:o[o.length-1].value}),l.push({frame:l[l.length-1].frame+120,value:l[l.length-1].value}),c.setKeys(o),h.setKeys(l),a.sphere.animations=[c,h],setTimeout(function(){a.anime=g.beginAnimation(a.sphere,0,o[o.length-1].frame,!0)},1200)})}g.activeCamera=x[0],g.beforeRender=function(){};S.find(function(e){return"Charlotte"===e.name});var I=0,O=0,L=0;p.runRenderLoop(function(){g.render(),I++,I%500==1?(x[++L%x.length].lockedTarget=S[O%S.length].sphere,g.activeCamera=x[L%x.length]):I%500==251&&(x[++L%x.length].lockedTarget=S[O++%S.length].sphere,g.activeCamera=x[L%x.length])}),window.addEventListener("resize",function(){p.resize()})}n.fromJson=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return t instanceof SVGElement||(t=document.querySelector("svg")),new n(t,e.gradients.map(function(e){return new a(e)}),e.cars)},Object.defineProperties(n.prototype,{init:{enumerable:!0,value:function value(){var _this3=this;if(!(this.svg instanceof SVGElement))throw new Error("RaceTrack.init requires valid svg element!");return this.svg.getElementById("gTrack")||this.svg.appendChild(this.gTrack),this.svg.getElementById("gCars")||this.svg.appendChild(this.gCars),this.simulation.force("fCollide",d3.forceCollide(function(e){return e.radius})),this.simulation.force("fRailing",function(e){var t=[];function i(i){e.forEach(function(e){t.forEach(function(t){var i=function(e,t){var i=[t.x+t.vx,t.y+t.vy],a=function a(e){return Math.hypot(e.x-i[0],e.y-i[1])},n=e.getTotalLength();var r,s,o,l=16,c=Number.POSITIVE_INFINITY;for(var _t3=0;_t3<=n;_t3+=l){var _i4=e.getPointAtLength(_t3),_n2=a(_i4);_n2<c&&(r=_i4,s=_t3,c=_n2)}if(c>=2*t.radius&&c>=Math.hypot(t.vx,t.vy))return{distance:c};l/=2;for(;l>.5;){var _t4=s-l,_i5=e.getPointAtLength(_t4),h=a(_i5),d=s+l;o=e.getPointAtLength(d);var m=a(o);_t4>=0&&h<c?(r=_i5,s=_t4,c=h):d<=n&&m<c?(r=o,s=d,c=m):l/=2}return{distance:c,after:o,best:r}}(e,t);if(i.distance<=t.radius||i.distance<=Math.hypot(t.vx/2,t.vy/2)){var _e3=[i.after.y-i.best.y,i.best.x-i.after.x];var _a3=Math.hypot.apply(Math,_toConsumableArray(_e3));_e3=_e3.map(function(e){return e/_a3});var _n3=[t.x-i.best.x,t.y-i.best.y];Math.acos((_n3[0]*_e3[0]+_n3[1]*_e3[1])/Math.hypot.apply(Math,_n3))>=Math.PI/2&&(_e3[0]=-_e3[0],_e3[1]=-_e3[1]);var _r=t.vx*_e3[0]+t.vy*_e3[1];if(Math.acos(_r/Math.hypot(t.vx,t.vy))<Math.PI/2)return;var _s=Math.random()+1,o=[],l=0;do{_s+=.05,o=[_s*_r*_e3[0],_s*_r*_e3[1]],l=Math.hypot(t.x+t.vx-o[0]-i.after.x,t.y+t.vy-o[1]-i.after.y)}while(Math.abs((t.vx-o[0])*_e3[0]+(t.vy-o[1])*_e3[1])<=Math.abs(_r)&&l<t.radius&&_s<3);if(_s<2){var _i6=[-_e3[1],_e3[0]];Math.acos((t.vx*_i6[0]+t.vy*_i6[1])/Math.hypot(t.vx,t.vy))>Math.PI/2&&(_i6[0]*=-1,_i6[1]*=-1);var _a4=t.vx*_i6[0]+t.vy*_i6[1];for(_s=.1;Math.hypot(t.vx-o[0],t.vy-o[1])<.6*Math.hypot(t.vx,t.vy)&&_s<1;){_s+=.1,o[0]-=.1*_a4*_i6[0],o[1]-=.1*_a4*_i6[1]}for(;Math.hypot(t.vx-o[0],t.vy-o[1])>Math.hypot(t.vx,t.vy);){o[0]+=.05*_a4*_i6[0],o[1]+=.05*_a4*_i6[1]}}t.vx-=o[0],t.vy-=o[1]}})})}return i.initialize=function(e){t=e},i}(this.rails)),this.simulation.nodes().forEach(function(e,t){e.lapTimes=[],e.x=-7*(t+1),e.y=5*Math.pow(-1,t),e.vx=.9,e.vy=0,e.trackAhead=_this3.gradients.slice(),e.pos=[]}),this.moveCars(),this.listCars(),this.simulation.alphaDecay(0),this.simulation.velocityDecay(.01),this.simulation.on("tick",function(){_this3.onTick()}),this}},onTick:{value:function value(){var _this4=this;if(this.simulation.nodes(this.simulation.nodes()),requestAnimationFrame(function(e){_this4.time=e}),this.tick++,this.moveCars(),this.listCars(),this.cars.every(function(e){return e.lapTimes.length>_this4.laps})){console.log("Sam, race over?"),console.log("Sam, cars:",this.cars),this.simulation.stop(),this.cars.forEach(function(e){delete e.sphere});var _e4=document.createElement("a");_e4.setAttribute("href","data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(this))));var _t5=new Date;return _e4.setAttribute("download","race-".concat(_t5.getFullYear(),"-").concat(_t5.getMonth()+1,"-").concat(_t5.getDate(),".json")),_e4.innerText="Save race data",document.querySelector("form").appendChild(_e4),void s(this)}return this}},moveCars:{value:function value(){var _this5=this;return d3.selectAll("#gCars circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),this.simulation.nodes().forEach(function(e,t,i){if(e.nextPiece){var _t6=_this5.gradients.indexOf(e.trackAhead[0]);if(!e.time.some(function(i){return i.lap===e.lapTimes.length&&i.piece===_t6})&&(e.time.push({lap:e.lapTimes.length,piece:_t6,tick:_this5.tick,time:_this5.time}),0===_t6&&(e.lapTimes.push(_this5.time),e.lapTimes.length>_this5.laps))){_this5.finalStanding.includes(e.name)||_this5.finalStanding.push(e.name);var _t7=_this5.finalStanding.indexOf(e.name);return void(e.x>_this5.gradients[0].x+10*(_this5.cars.length-_t7)&&(e.fx=e.x,e.fy=e.y))}e.trackAhead.push(e.trackAhead.shift()),e.nextPiece=!1}e.previousPiece&&(e.trackAhead.unshift(e.trackAhead.pop()),e.previousPiece=!1),(e.x<_this5.extrema[0][0]-10||e.x>_this5.extrema[0][1]+10||e.y<_this5.extrema[1][0]-10||e.y>_this5.extrema[1][1]+10)&&(console.log("Sam, car out of bounds!"),_this5.simulation.stop())}),this.cars.forEach(function(e){e.pos.push({tick:_this5.tick,time:_this5.time,vx:e.vx,vy:e.vy,x:e.x,y:e.y})}),this}},setTrack:{enumerable:!0,value:function value(e){var _this6=this;this.gradients=e.filter(function(e){return e instanceof a});var t=[0,0];var n=[[0,0],[0,0]],r=[[],[]];this.rails=new Array(2).fill({});var s=[];this.gTrack.innerHTML="",this.gradients.forEach(function(e,a){t[0]+=e.delta[0],t[1]+=e.delta[1],s.push([t[0],t[1]]),e.x=t[0],e.y=t[1],e.force&&_this6.simulation.force("piece".concat(a),e.force);var o=Math.acos(e.gradient[0]/Math.hypot.apply(Math,_toConsumableArray(e.gradient)));e.gradient[1]<0&&(o=2*Math.PI-o);var l={x1:t[0]+e.width*Math.sin(o),y1:t[1]-e.width*Math.cos(o),x2:t[0]-e.width*Math.sin(o),y2:t[1]+e.width*Math.cos(o)};e.m=(l.y2-l.y1)/(l.x2-l.x1),e.b=-e.m*l.x1+l.y1;var c=document.createElementNS(i,"line");r[0].push({before:[l.x1-e.width*Math.cos(o)*e.rail[0],l.y1-e.width*Math.sin(o)*e.rail[0]],is:[l.x1,l.y1],after:[l.x1+e.width*Math.cos(o)*e.rail[0],l.y1+e.width*Math.sin(o)*e.rail[0]]}),r[1].push({before:[l.x2-e.width*Math.cos(o)*e.rail[1],l.y2-e.width*Math.sin(o)*e.rail[1]],is:[l.x2,l.y2],after:[l.x2+e.width*Math.cos(o)*e.rail[1],l.y2+e.width*Math.sin(o)*e.rail[1]]}),n[0][0]=Math.min(n[0][0],l.x1,l.x2),n[0][1]=Math.max(n[0][1],l.x1,l.x2),n[1][0]=Math.min(n[1][0],l.y1,l.y2),n[1][1]=Math.max(n[1][1],l.y1,l.y2),Object.entries(l).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),e=_ref2[0],t=_ref2[1];c.setAttribute(e,t)}),c.classList.add("checkpoint"),0===a&&c.classList.add("start-line"),_this6.gTrack.appendChild(c),d3.select("svg #gTrack").append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",0===a?1.5:2).attr("fill",e.color||"whitesmoke").attr("strokeWidth",0===a?"0.5px":"0").attr("stroke",0===a?"white":"none")}),this.extrema=n,r.forEach(function(e,t){e.push(e[0]);var a=document.createElementNS(i,"path"),n=[];e.forEach(function(t,i){0===i?n.push("M".concat(t.is.join(","))):n.push("C".concat([e[i-1].after.join(" "),t.before.join(" "),t.is.join(" ")].join(",")))}),a.setAttribute("d",n.join("")),_this6.gTrack.appendChild(a),_this6.rails[t]=a});var o=n[0][1]-n[0][0]+20,l=n[1][1]-n[1][0]+20,c=n[0][0]-10,h=n[1][0]-10;return l>4*o/5?(o=5*l/4,c=(n[0][0]+n[0][1]-o)/2):(l=4*o/5,h=(n[1][0]+n[1][1]-l)/2),this.svg.setAttribute("viewBox","".concat(c," ").concat(h," ").concat(o," ").concat(l)),d3.select("svg").append("g").selectAll("path").data([s]).enter().append("path").attr("d",d3.line().curve(d3.curveBasisClosed)).classed("lane-line",!0),this}},setCars:{enumerable:!0,value:function value(e){return d3.select("svg #gCars").selectAll("circle").data(e).enter().append("circle").classed("car",!0).attr("fill",function(e){return e.color}).attr("stroke",function(e){return e.color2}).attr("stroke-width",function(e){return e.strokeWidth}).attr("r",function(e){return e.r}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),this.simulation.nodes(e),this.cars=e.slice(),this}},listCars:{enumerable:!0,value:function value(){var _this7=this;var e=[];var t=document.querySelector("ol#positions");return this.cars.slice().sort(function(e,t){return 0===e.time.length&&0===t.time.length?0:0===e.time.length?1:0===t.time.length||e.time.length>t.time.length?-1:e.time.length<t.time.length||e.time[e.time.length-1].time>t.time[t.time.length-1].time?1:e.time[e.time.length-1].time<t.time[t.time.length-1].time?-1:0}).forEach(function(i,a){if(!(i.elPositionList instanceof Element)){i.elPositionList=document.createElement("li");var _e5=document.createElement("span");_e5.classList.add("name"),_e5.innerText=i.name,i.elPositionList.appendChild(_e5);var _t8=document.createElement("span");_t8.classList.add("time"),i.elPositionList.appendChild(_t8)}var n=i.elPositionList;if(i.time.length>1){var _t9=i.time.slice().pop();0===a&&(e=i.time.slice());var _r2=n.querySelector(".time");if(0===a){var _e6=((_t9.time-i.time[0].time)/1e3).toFixed(2);_r2.innerText!==_e6&&(_r2.innerText=_e6),_r2.classList.remove("fade-out")}else{var _a5=e.filter(function(e){return e.lap===_t9.lap&&e.piece===_t9.piece}).sort(function(e,t){return e.time-t.time})[0];var _n4=(_t9.time-_a5.time)/1e3;_n4=_n4>0?"+".concat(_n4.toFixed(2)):_n4.toFixed(2),_r2.innerText!==_n4&&(_r2.classList.remove("fade-out"),i.lapTimes.length<_this7.laps&&setTimeout(function(){_r2.classList.add("fade-out")},1e3),_r2.innerText=_n4)}}n.style.order=a,n.setAttribute("order",a+1),t.contains(n)||t.appendChild(n)}),this}}}),Object.defineProperties(r.prototype,{})}]);