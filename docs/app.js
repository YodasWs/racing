"use strict";function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e){a.d(n,i,function(t){return e[t]}.bind(null,i))}return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t){e.exports=function(e){var _this=this;Object.assign(this,{gradient:[1,0],delta:[0,0],width:20,rail:[.5,.5]},e);var t=Math.hypot.apply(Math,_toConsumableArray(this.gradient));var a=Math.acos(this.gradient[0]/t);this.gradient[1]<0&&(a=2*Math.PI-a),this.α=a,this.force=function(){var e=[];var t=_this;function a(a){e.forEach(function(e){if(0===e.trackAhead.length)return;if(e.trackAhead[0]!==t)return;var n=Math.hypot(e.vx,e.vy),i=[e.vx/n,e.vy/n],r=t.gradient.map(function(e){return e/Math.hypot.apply(Math,_toConsumableArray(t.gradient))});var o=[r[0]-i[0],r[1]-i[1]];var s=Math.acos((o[0]*i[0]+o[1]*i[1])/Math.hypot.apply(Math,_toConsumableArray(o)));(Number.isNaN(s)||180*s/Math.PI<Number.EPSILON)&&(o=[0,0]);var c=Math.hypot.apply(Math,_toConsumableArray(o));c>1?o=o.map(function(e){return e/c*.02}):c>0&&(o=o.map(function(e){return .02*e})),o=o.map(function(e,t){return e+r[t]*(1/7)}),e.vx+=o[0]*a,e.vy+=o[1]*a;var l=[e.x+e.vx,e.y+e.vy];if(Number.isFinite(t.m)&&Number.isFinite(t.b)&&0!==t.α&&t.α!==Math.PI&&t.α!==2*Math.PI){var _a=t.m*l[0]+t.b;t.α>0&&t.α<Math.PI&&_a<=l[1]&&(e.nextPiece=!0),t.α>Math.PI&&_a>=l[1]&&(e.nextPiece=!0)}else 0===t.α&&t.x<l[0]&&(e.nextPiece=!0),t.α===Math.PI&&t.x>l[0]&&(e.nextPiece=!0);var d=e.trackAhead.slice(-1).pop();if(Number.isFinite(d.m)&&Number.isFinite(d.b)&&0!==d.α&&d.α!==Math.PI&&d.α!==2*Math.PI){var _t=d.m*e.x+d.b;d.α>0&&d.α<Math.PI&&_t>e.y&&(e.previousPiece=!0),d.α>Math.PI&&_t<e.y&&(e.previousPiece=!0)}else 0===d.α&&d.x>e.x&&(e.previousPiece=!0),d.α===Math.PI&&d.x<e.x&&(e.previousPiece=!0);e.previousPiece&&(e.nextPiece=!1)})}return a.initialize=function(t){e=t},a}()}},function(e,t,a){e.exports=a(2)},function(e,t,a){var n={};n.cSuzuka=a(3);var i=a(0),r=a(4),o=a(6);yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",function(){var e=document.querySelector("svg#scene");document.getElementById("btnTick").remove();var t=document.createElement("button");t.innerText="Flag!",t.addEventListener("click",function(e){e.preventDefault(),console.error("Sam, flag!")}),document.querySelector("form").appendChild(t);n.cSuzuka.forEach(function(e){e.delta=e.delta.map(function(e){return 2*e}),Array.isArray(e.rail)&&(e.rail=e.rail.map(function(e){return 1.5*e}))});var a=new r(e,n.cSuzuka.map(function(e){return new i(e)}),[new o("Alice, TX",{color:"lightgreen",color2:"orange",rgb:[144,238,144]}),new o("Dallas, TX",{color:"white",color2:"blue",r:3,strokeWidth:3,rgb:[0,0,255]}),new o("Charlotte, NC",{color:"#249E57",color2:"lightgrey",r:3.5,strokeWidth:2,rgb:[36,158,87]}),new o("Brooklyn, NY",{color:"white",color2:"black",r:3,strokeWidth:3,rgb:[68,68,68]}),new o("Edison, NJ",{color:"lightblue",color2:"cornflowerblue",r:3.5,strokeWidth:2,rgb:[173,216,230]}),new o("Florence, TN",{color:"#1E3258",color2:"#BF1F2D",r:3.5,strokeWidth:2,rgb:[191,31,45]})],{laps:10});a.simulation.stop(),a.init(),d(a),document.getElementById("btnStart").focus(),document.getElementById("btnStart").addEventListener("click",function(e){switch(e.preventDefault(),e.currentTarget.innerText){case"Start":console.log("Sam, start!"),a.simulation.stop(),a.init(),a.simulation.alpha(1),setTimeout(function(e){a.simulation.restart(),e.innerText="Pause",e.disabled=!1,e.focus()},500,e.currentTarget),e.currentTarget.disabled=!0,clearInterval(l);break;case"Pause":a.simulation.stop(),e.currentTarget.innerText="Play";break;case"Play":a.simulation.restart(),e.currentTarget.innerText="Pause";}}),document.getElementById("btnTick")instanceof Element&&document.getElementById("btnTick").addEventListener("click",function(e){e.preventDefault(),a.simulation.tick(),a.onTick()}),document.querySelector("input[type=\"file\"]").addEventListener("change",function(t){var n=t.target.files[0];if("application/json"!==n.type)return void t.preventDefault();var i=new FileReader;i.onload=function(t){var n=JSON.parse(t.target.result);a=r.fromJson(n,e),a.simulation.stop(),d(a);var i=document.querySelector("form #btnExport");i instanceof HTMLElement&&i.removeAttribute("disabled")},i.readAsText(n)})});var s=function(){var e=new EventTarget,t=new Set;var a;return e.addφListener=function(a,n){t.add(a),e.addEventListener("\u03C6Change",function(e){e.detail.φ===a&&n(e)})},e.φChange=function(n,i){t.forEach(function(t){a<=t&&t<n&&e.dispatchEvent(new CustomEvent("\u03C6Change",{detail:{"\u03C6":t}}))}),a=n},e}(),c=function(){var e={"set\u03C6ToActivateCamera":{value:function value(e){var _this2=this;s.addφListener(e,function(e){scene.activeCamera=_this2})}}};return new Proxy(function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var _ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref$Range=_ref["\u03C6Range"],a=_ref$Range===void 0?[-Math.PI/2,3*Math.PI/2]:_ref$Range;this.φRange=a,this.uuid=Math.floor(1e3*Math.random()).toString().padStart(3,"0")},{construct:function construct(t,a){var _a2=_slicedToArray(a,2),n=_a2[0],i=_a2[1],r=BABYLON[n];if(!r)throw new TypeError("Unknown camera type '".concat(n,"'"));if(!(r.prototype instanceof BABYLON.TargetCamera))throw new TypeError("Invalid camera type '".concat(n,"'"));var o=Object.create(r.prototype);return r.apply(o,i),t.apply(o,a),Object.defineProperties(o.__proto__,e),o}})}();var l;function d(e){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$OverheadCirclin=_ref2.OverheadCirclingSpeed,t=_ref2$OverheadCirclin===void 0?5:_ref2$OverheadCirclin,_ref2$filmCountdownOn=_ref2.filmCountdownOnly,a=_ref2$filmCountdownOn===void 0?!1:_ref2$filmCountdownOn,_ref2$doExport=_ref2.doExport,n=_ref2$doExport===void 0?!1:_ref2$doExport,_ref2$targetFrameRate=_ref2.targetFrameRate,i=_ref2$targetFrameRate===void 0?30:_ref2$targetFrameRate,_ref2$renderFrameRate=_ref2.renderFrameRate,r=_ref2$renderFrameRate===void 0?30:_ref2$renderFrameRate;clearInterval(l);var _BABYLON=BABYLON,o=_BABYLON.AbstractMesh,h=_BABYLON.Animation,m=_BABYLON.AnimationGroup,u=_BABYLON.Color3,p=_BABYLON.Color4,f=_BABYLON.DirectionalLight,g=_BABYLON.Engine,y=_BABYLON.FollowCamera,v=_BABYLON.Mesh,T=_BABYLON.MeshBuilder,x=_BABYLON.Scene,w=_BABYLON.SkyMaterial,E=_BABYLON.StandardMaterial,b=_BABYLON.Texture,C=_BABYLON.UniversalCamera,A=_BABYLON.Vector3,M=_BABYLON.GUI,I=_BABYLON.GrassProceduralTexture,P=_BABYLON.DynamicTerrain,k=document.querySelector("canvas#replay"),N=new g(k,!0),L=new x(N);L.useRightHandedSystem=!0,L.ambientColor=new u(.8,.8,.8);var S={cross:Math.max(Math.abs(e.extrema[0][1]-e.extrema[0][0]),Math.abs(e.extrema[1][1]-e.extrema[1][0])),height:e.extrema[1][1]-e.extrema[1][0],width:e.extrema[0][1]-e.extrema[0][0],midpoint:new A((e.extrema[0][0]+e.extrema[0][1])/2,0,(e.extrema[1][0]+e.extrema[1][1])/2)};Object.entries({sPosition:{get:function get(){var e=[this.position.x-S.midpoint.x,this.position.y-S.midpoint.y,this.position.z-S.midpoint.z],t=Math.hypot.apply(Math,e);return{r:t,"\u03C6":0===e[0]?0:Math.atan(e[2]/e[0])+(e[0]<0?Math.PI:0),"\u03B8":0===e[1]?0:Math.acos(Math.hypot(e[0]/t,e[2]/t)/e[1]/t)}},set:function set(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}var _ref3=Array.isArray(e[0])?e[0]:e,_ref4=_slicedToArray(_ref3,3),t=_ref4[0],a=_ref4[1],n=_ref4[2];this.position=new A(t*Math.sin(n)*Math.cos(a)+S.midpoint.x,t*Math.sin(n)*Math.sin(a)+S.midpoint.z,t*Math.cos(n)+S.midpoint.y)}}}).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),e=_ref6[0],t=_ref6[1];[BABYLON.TransformNode.prototype,BABYLON.Camera.prototype].forEach(function(a){a.hasOwnProperty(e)||Object.defineProperty(a,e,t)})});var O=new w("sky",L);O.backFaceCulling=!1,O.luminance=.2,O.useSunPosition=!0,O.sunPosition=new A(10,3,1),O.turbidity=2,O.rayleigh=3,O.cameraOffset.y=200;var R=v.CreateSphere("skyBox",5,2*S.cross,L);R.material=O,R.position=S.midpoint;var _=new f("light2",O.sunPosition.negate(),L);_.diffuse=new u(1,1,1),_.intensity=.5;var F=[new c("UniversalCamera",["universalCamera3",new A(e.extrema[0][0],20,e.extrema[1][0]-30),L],{"\u03C6Range":[150*Math.PI/180,3*Math.PI/2]}),new c("UniversalCamera",["universalCamera1",new A(-35,160,2*e.extrema[1][1]),L]),new c("UniversalCamera",["cameraTopRightCorner",new A(e.extrema[0][1]+10,20,e.extrema[1][0]-10),L],{"\u03C6Range":[-Math.PI/2,10*Math.PI/180]}),new c("UniversalCamera",["universalCamera4",new A(-50,20,e.extrema[1][1]+70),L],{"\u03C6Range":[0*Math.PI/180,125*Math.PI/180]}),new c("UniversalCamera",["universalCameraA",new A(e.extrema[0][0]+200,20,e.extrema[1][0]-10),L])];F.find(function(e){return"cameraTopRightCorner"===e.id}).setφToActivateCamera(0);var G=new E("grass",L);G.ambientColor=new u(127/255,229/255,112/255),G.ambientTexture=new I("grassPT",256,L);var j=new E("asphalt",L);j.ambientColor=new u(183/255,181/255,186/255);var B=new I("asphaltPT",256,L);B.grassColors=[new u(183/255,181/255,186/255),new u(135/255,133/255,138/255),new u(151/255,149/255,154/255)],j.ambientTexture=B;var z=new E("black",L);z.diffuseColor=new u(1/255,1/255,1/255),z.ambientColor=new u(1/255,1/255,1/255);var D=new E("siding",L);D.diffuseColor=new u(235/255,88/255,99/255),D.ambientColor=new u(235/255,88/255,99/255);var V=new Float32Array(12e4);for(var _e2=0;_e2<200;_e2++){for(var _t2=0;_t2<200;_t2++){var _a3=[5*(_t2-100),-.05,5*(_e2-100)];V[3*(200*_e2+_t2)+0]=_a3[0],V[3*(200*_e2+_t2)+1]=_a3[1],V[3*(200*_e2+_t2)+2]=_a3[2]}}var H=new P("dtGround",{mapData:V,mapSubX:200,mapSubZ:200,terrainSub:60},L);H.updateCameraLOD=function(e){return Math.abs(e.globalPosition.y/10|0)},H.mesh.material=G,H.isAlwaysVisible=!0,function(){var a=[],n=new h("spinningCamera","position",r,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CYCLE),_ref7=S.height<S.width?[.7*S.width,1*S.height]:[S.width*(.5+1/6),S.height*(.5+1/6)],_ref8=_slicedToArray(_ref7,2),i=_ref8[0],o=_ref8[1];for(var _e3=0;_e3<360;_e3++){a.push({frame:Math.floor(_e3*t),value:new A(Math.cos((180+_e3)*Math.PI/180)*i+S.midpoint.x,100,Math.sin((180+_e3)*Math.PI/180)*o+S.midpoint.z)})}n.setKeys(a);var s=new m("animeFlyover");s.normalize(0,a[a.length-1].frame);var c=e.cars.slice(0,3),l=new A(c.reduce(function(e,t){return e+t.posn[0].x},0)/c.length,c.reduce(function(e,t){return e+t.radius},0)/c.length,c.reduce(function(e,t){return e+t.posn[0].y},0)/c.length);F.filter(function(e){return"universalCameraA"===e.id}).forEach(function(e){e.lockedTarget=l,s.addTargetedAnimation(n,e)}),s.play(!0)}();var U=[[],[]],q=[[],[]];e.rails.forEach(function(e,t){var a=e.getTotalLength();for(var _n2=0;_n2<100;_n2+=1){var _i2=e.getPointAtLength(a*_n2/100);U[t].push(new A(_i2.x,0,_i2.y)),q[t].push(new A(_i2.x,5,_i2.y))}}),q.forEach(function(e,t){var a=[e,U[t]];T.CreateRibbon("rail"+t,{sideOrientation:v.DOUBLESIDE,pathArray:a,closePath:!0},L).material=D});T.CreateRibbon("track",{pathArray:U.reverse(),closePath:!0},L).material=j;var Y=e.gradients[0];T.CreateLines("startLine",{points:[new A(Y.x-Y.width*Math.sin(Y.α),.02,Y.y+Y.width*Math.cos(Y.α)),new A(Y.x+Y.width*Math.sin(Y.α),.02,Y.y-Y.width*Math.cos(Y.α))],colors:new Array(2).fill(new p(0,0,0,1)),useVertexAlpha:!1},L).material=z;var $=e.cars.slice();$.forEach(function(e){var t=e.posn[0];if(e.sphere=T.CreateSphere("sphere"+e.name,{segments:16,diameter:2*e.radius},L),e.sphere.position=new A(t.x,e.radius,t.y),Array.isArray(e.rgb)){var _t3=new E(e.name+"Material",L);_t3.diffuseColor=_construct(u,_toConsumableArray(e.rgb.map(function(e){return e/255}))),_t3.ambientColor=_construct(u,_toConsumableArray(e.rgb.map(function(e){return e/255}))),_t3.diffuseTexture=new b("ball.png",L),e.sphere.material=_t3}});var W=7;var Z=n?h.ANIMATIONLOOPMODE_CONSTANT:h.ANIMATIONLOOPMODE_CYCLE;var J;var X={flyover:{playTime:a?1:20,nextStage:"countdown",loopAnimes:!0,camera:F.find(function(e){return"universalCameraA"===e.id}),cameras:F},countdown:{animes:new m("animeCountdown"),camera:F.find(function(e){return"universalCamera1"===e.id}),nextStage:"race",playTime:3.5},race:{animes:new m("animeRace"),secondsToSwitchCameras:5,rotateCamera:!0,cameras:F,nextStage:"afterRace"},afterRace:{secondsToSwitchCameras:2.5,rotateCamera:!0,playTime:20,cameras:F}};X.events=new EventTarget,X.events.addEventListener("start",function(e){var _this3=this;J=e.detail;var t=X[J];if(!t)throw Error("Could not find stage "+J);"string"==typeof t.camera?L.activeCamera=F.find(function(e){return e.id===t.camera}):t.camera instanceof BABYLON.TargetCamera&&(L.activeCamera=t.camera),"function"==typeof t.onStartStage&&t.onStartStage(),t.animes instanceof m&&t.animes.play(!!t.loopAnimes),Number.isFinite(t.playTime)&&t.playTime>0&&setTimeout(function(){_this3.dispatchEvent(new CustomEvent("end",{detail:J}))},1e3*t.playTime*i/r)}),X.events.addEventListener("end",function(e){var t=e.detail;if(X[t]){var _e4=X[t];"function"==typeof _e4.onEndStage&&_e4.onEndStage(),_e4.nextStage&&X[_e4.nextStage]&&this.dispatchEvent(new CustomEvent("start",{detail:_e4.nextStage})),_e4.overlay&&_e4.overlay.autoDispose&&_e4.overlay.dispose()}}),X.flyover,function(e){var t=M.AdvancedDynamicTexture,a=M.Control,n=M.Rectangle,o=M.TextBlock,s=new t.CreateFullscreenUI("myUI");s.useInvalidateRectOptimization=!1,s.renderScale=2,e.overlay=s;var c=new n;c.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,c.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,c.background="white",c.height="0.1",c.width="0.25",c.paddingLeft="20%",c.clipChildren=!1,c.clipContent=!1,c.cornerRadius=100;var l=new o;l.fontSize=100,l.fontWeight="bold",l.color="black",l.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,l.textVerticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,l.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,c.addControl(l);var d,h=3;var m=function m(){3===h&&s.addControl(c),l.text=h>0?h.toString():"Go!",h--};e.onStartStage=function(){setTimeout(function(){m(),d=setInterval(m,1e3*i/r)},500*i/r)},e.onEndStage=function(){d&&(m(),clearInterval(d)),setTimeout(function(){s.removeControl(c),s.dispose()},1e3*i/r)}}(X.countdown);var K=function K(e,t){return t.tick-e.tick},Q=function(e){var t=[];var a=function a(){t=e.map(function(e){return{name:e.name,radius:e.radius,lenTime:e.time.length,time:e.time.slice().sort(K),posn:e.posn.slice().sort(K)}})};a();var n=function n(e){return t.forEach(function(t){t.curTime=t.time.find(function(t){return t.tick<=e}),t.curPosn=t.posn.find(function(t){return t.tick<=e})}),t.sort(function(e,t){if(0===e.lenTime&&0===t.lenTime)return 0;if(0===e.lenTime)return 1;if(0===t.lenTime)return-1;if(void 0===e.curTime&&void 0===t.curTime)return 0;if(void 0===e.curTime)return 1;if(void 0===t.curTime)return-1;if(e.curTime.lap<t.curTime.lap)return 1;if(e.curTime.lap>t.curTime.lap)return-1;if(e.curTime.piece!==t.curTime.piece){if(0===e.curTime.piece)return-1;if(0===t.curTime.piece)return 1;if(e.curTime.piece<t.curTime.piece)return 1;if(e.curTime.piece>t.curTime.piece)return-1}return e.curTime.tick<t.curTime.tick?-1:e.curTime.tick>t.curTime.tick?1:0}),t};return n.reset=a,n}($);var ee;if($[0].posn.length>1){var _t4=0;var _a4=2*Math.PI;if($.forEach(function(e,n){var i=0,o=0;var s=[],c=[new h("moveAnime"+e.name,"position",r,h.ANIMATIONTYPE_VECTOR3,Z),new h("spinAnime"+e.name,"rotation",r,h.ANIMATIONTYPE_VECTOR3,Z)];c.forEach(function(e){return s.push([])}),e.posn.forEach(function(n){s[0].push({frame:3*n.tick,value:new A(n.x,e.radius,n.y)});var r=Math.hypot(n.vx,n.vy);if(r>0){var _e5=-Math.sign(n.vy)*Math.acos(n.vx/r)%_a4-o%_a4;for(;Math.abs(_e5)>Math.PI;){_e5-=Math.sign(_e5)*_a4}o+=_e5,i-=r*Math.PI/16}s[1].push({frame:3*n.tick,value:new A(0,o,i)}),_t4=Math.max(_t4,n.tick)}),W=s.reduce(function(e,t){return Math.max(e,t[t.length-1].frame)},W),c.forEach(function(t,a){t.setKeys(s[a]),X.race.animes.addTargetedAnimation(t,e.sphere)})}),!(document.querySelector("form #btnExport")instanceof HTMLElement)){var _t5=document.createElement("button");_t5.setAttribute("id","btnExport"),_t5.innerText="Export",_t5.addEventListener("click",function(){_t5.setAttribute("disabled","disabled"),clearInterval(l),d(e,{OverheadCirclingSpeed:2.5,doExport:!0,targetFrameRate:60,renderFrameRate:2})});var _a5=document.querySelector("form");_a5 instanceof Element&&_a5.appendChild(_t5)}(function(){var e=[],a=[new h("cameraTrack","position",r,h.ANIMATIONTYPE_VECTOR3,Z)];a.forEach(function(t){return e.push([])});for(var _a6=0;_a6<_t4;_a6++){var _t6=Q(_a6).slice(0,3),_n3=[_t6.reduce(function(e,t){return e+t.curPosn.x},0)/_t6.length,_t6.reduce(function(e,t){return e+t.radius},0)/_t6.length,_t6.reduce(function(e,t){return e+t.curPosn.y},0)/_t6.length];e[0].push({frame:3*_a6,value:_construct(A,_n3),"\u03C6":0===_n3[0]?0:Math.atan(_n3[2]/_n3[0])})}Q.reset(),W=e.reduce(function(e,t){return Math.max(e,t[t.length-1].frame)},W),ee=new o("raceCameraTarget",L),ee.position=e[0][0].value,X.race.cameras.forEach(function(e){return e.lockedTarget=ee}),F.filter(function(e){return"universalCameraA"===e.id}).forEach(function(e){e.lockedTarget=ee}),a.forEach(function(t,a){t.setKeys(e[a]),X.race.animes.addTargetedAnimation(t,ee)})})(),X.race.animes.normalize(0,W)}else delete X.flyover.nextStage,X.flyover.cameras.forEach(function(e){return e.setTarget(new A(0,4.5,0))});var te=function(){var t=M.AdvancedDynamicTexture,a=M.Control,n=M.StackPanel,i=M.TextBlock,r=M.XmlLoader,o=new t.CreateFullscreenUI("myUI");o.useInvalidateRectOptimization=!1,o.renderScale=2,X.race.overlay=o,X.race.overlay.autoDispose=!0;var s=new n;s.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=a.VERTICAL_ALIGNMENT_TOP,s.background="white",s.width="0.14",s.top="0",s.left="0",s.clipChildren=!1,s.clipContent=!1,X.events.addEventListener("start",function(e){"flyover"===e.detail&&o.addControl(s)});var c=new n;c.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,c.verticalAlignment=a.VERTICAL_ALIGNMENT_BOTTOM,c.background="white",c.width="0.1",c.clipChildren=!1,c.clipContent=!1;var l=new i;l.fontSize=70,l.height="110px",l.color="black",l.paddingLeft="20px",l.paddingBottom="20px",l.paddingTop="20px",l.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,l.textVerticalAlignment=a.VERTICAL_ALIGNMENT_BOTTOM,c.addControl(l);var d=new Array($.length).fill(0).map(function(e,t){var n=new i;return n.fontSize=70,n.color="black",n.paddingLeft="10px",n.height="90px",0===t&&(n.paddingTop="20px",n.height="110px"),n.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,n.textVerticalAlignment=a.VERTICAL_ALIGNMENT_TOP,s.addControl(n),n});return function(t){Q(t).forEach(function(t,a){0===a&&t.curTime&&(o.addControl(c),t.curTime.lap>e.laps?l.text="Finish!":t.curTime.lap>0?l.text="Lap ".concat(t.curTime.lap," / ").concat(e.laps):l.text="GO!"),d[a].text="".concat(a+1," ").concat(t.name)})}}();(function(e){var t=M.AdvancedDynamicTexture,a=M.Control,n=M.StackPanel,i=M.TextBlock,r=X.afterRace,o=new t.CreateFullscreenUI("myUI");o.useInvalidateRectOptimization=!1,o.renderScale=2,r.overlay=o;var s=new n;s.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_RIGHT,s.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,s.background="white",s.width="0.31",s.clipChildren=!1,s.clipContent=!1;var c=new Array($.length).fill(0).map(function(e,t){var n=new i;return n.fontSize=150,n.color="black",n.paddingLeft="10px",n.height=n.fontSize+30+"px",n.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,n.textVerticalAlignment=a.VERTICAL_ALIGNMENT_TOP,s.addControl(n),n});X.events.addEventListener("start",function(e){"afterRace"===e.detail&&o.addControl(s)}),r.overlay.render=function(){Q(W/3).forEach(function(e,t){c[t].text="".concat(t+1," ").concat(e.name)})}})(),L.activeCamera=F[0];var ae=function(){var e=1;return X.race.animes.onAnimationGroupPlayObservable.add(function(){e=0}),X.race.animes.onAnimationGroupEndObservable.add(function(){e=0}),{pickNextCamera:function pickNextCamera(){if(!0===X[J].rotateCamera&&ie%X[J].framesToSwitchCameras==0){if(ee instanceof o){var _t7=e;L.activeCamera;do{if(e++,F[e%F.length].φRange[0]<=ee.sPosition.φ&&ee.sPosition.φ<F[e%F.length].φRange[1])break}while(e%F.length!=_t7%F.length)}else e++;!function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("newActiveCameraIndex must be a nonnegative integer");e=t,L.activeCamera=F[t%F.length]}(e),e%F.length==0&&re++}}}}(),ne=function(e){return e?new WebMWriter({quality:.95,frameRate:i}):{addFrame:function addFrame(){},complete:function complete(){return Promise.reject()}}}(n);var ie=0,re=0;Object.entries(X).forEach(function(_ref9){var _ref10=_slicedToArray(_ref9,2),e=_ref10[0],t=_ref10[1];Number.isFinite(t.secondsToSwitchCameras)&&(X[e].framesToSwitchCameras=t.secondsToSwitchCameras*i)}),L.beforeRender=function(e){H.camera!==e.activeCamera&&(H.camera=e.activeCamera,H.camera.position.y<30&&(H.initialLOD=5))},L.afterRender=function(e){n&&("flyover"!==J||ie>5)&&ne.addFrame(k)},console.log("Sam, max number of frames:",W),Object.entries(X).forEach(function(_ref11){var _ref12=_slicedToArray(_ref11,2),e=_ref12[0],t=_ref12[1];t.animes instanceof m&&("function"==typeof t.onStartAnimation&&t.animes.onAnimationGroupPlayObservable.add(t.onStartAnimation),t.animes.onAnimationGroupEndObservable.add(function(){X.events.dispatchEvent(new CustomEvent("end",{detail:e}))}))}),X.race.animes.onAnimationGroupPlayObservable.add(function(){J="race",ie=0,re=0}),X.race.animes.onAnimationGroupEndObservable.add(function(){J="afterRace",ie=0,re=0,W=X.afterRace.playTime*i,X.events.dispatchEvent(new CustomEvent("end",{detail:"race"}))}),l=setInterval(function(){L.render(),["flyover","countdown"].includes(J)&&te(0),X.race.animes.isPlaying&&te(ie/3),X[J].overlay&&"function"==typeof X[J].overlay.render&&X[J].overlay.render(ie/3),ae.pickNextCamera(),ee instanceof o&&s.φChange(ee.sPosition.φ),ie++,ie%20==0&&n&&console.log("Sam, frame",ie,",",(ie/i).toFixed(3),"seconds");var e=!1;a&&"race"===J&&ie>=1*i&&(e=!0),"afterRace"===J&&ie>=X.afterRace.playTime*i&&(e=!0),e&&(console.log("Sam, at end of video!"),n||a?(clearInterval(l),console.log("Sam, done running WebGL animation"),ne.complete().then(function(e){var t=URL.createObjectURL(e),a=document.querySelector("main");if(a instanceof Element){var _e6=document.createElement("a");_e6.innerText="Open  in new window",_e6.setAttribute("target","_blank"),_e6.setAttribute("href",t),a.appendChild(_e6);var _n4=document.createElement("video"),_i3=document.createElement("source");_i3.setAttribute("type","video/webm"),_i3.setAttribute("src",t),_n4.appendChild(_i3),a.appendChild(_n4)}else window.open(t,"_blank")}).catch(function(e){console.error("Sam, videoWriter failed:",e)})):(Q.reset(),X.race.animes.play(!1)))},1e3/r),N.resize(),window.addEventListener("resize",function(){N.resize()}),J||X.events.dispatchEvent(new CustomEvent("start",{detail:"flyover"}))}},function(e){e.exports=JSON.parse("[{\"gradient\":[1,0],\"delta\":[0,0],\"width\":20,\"color\":\"black\",\"flyoverPoint\":true},{\"gradient\":[1,0],\"delta\":[75,0],\"width\":20,\"rail\":[0.5,0.25],\"flyoverPoint\":true},{\"gradient\":[1,2],\"delta\":[25,15],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[1,2],\"delta\":[15,30],\"width\":20,\"rail\":[0.5,0.25]},{\"gradient\":[0,1],\"delta\":[4,15],\"width\":20,\"rail\":[0.5,0.125]},{\"gradient\":[0,1],\"delta\":[0,10],\"width\":20,\"rail\":[1.5,0.125],\"color\":\"lightgreen\",\"flyoverPoint\":true},{\"gradient\":[-1,0],\"delta\":[-25,25],\"width\":20,\"rail\":[1,0.125]},{\"gradient\":[-5,-1],\"delta\":[-30,-5],\"width\":20,\"rail\":[0.25,1.5],\"color\":\"lightgreen\"},{\"gradient\":[-2,3],\"delta\":[-35,20],\"width\":20,\"rail\":[0.5,0.125]},{\"gradient\":[-3,-2],\"delta\":[-35,10],\"width\":20,\"rail\":[1.5,0.16667],\"color\":\"lightgreen\",\"flyoverPoint\":true},{\"gradient\":[-3,-2],\"delta\":[-30,-20],\"width\":20,\"rail\":[0.25,1]},{\"gradient\":[-2,3],\"delta\":[-35,5],\"width\":20,\"rail\":[0.25,1]},{\"gradient\":[-2,3],\"delta\":[-5,7.5],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[-3,-2],\"delta\":[-35,10],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[-3,-2],\"delta\":[-30,-20],\"width\":20,\"rail\":[0.25,1]},{\"gradient\":[-1,0],\"delta\":[-30,-12.5],\"width\":20,\"rail\":[0.25,0.5]},{\"gradient\":[-1,1],\"delta\":[-27.5,10],\"width\":20,\"rail\":[0.2,0.75]},{\"gradient\":[-1,0],\"delta\":[-35,20],\"width\":20,\"rail\":[1.5,0.5],\"flyoverPoint\":true},{\"gradient\":[0,-1],\"delta\":[-40,-35],\"width\":20,\"rail\":[2,0.75]},{\"gradient\":[0,-1],\"delta\":[0,-39],\"width\":20,\"rail\":[2,1],\"color\":\"lightgreen\",\"flyoverPoint\":true},{\"gradient\":[1,0],\"delta\":[45,-45],\"width\":20,\"rail\":[2,1],\"flyoverPoint\":true}]")},function(e,t,a){var n="http://www.w3.org/2000/svg",i=a(0);function r(e,t,a){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var r=d3.forceSimulation();Object.assign(this,{laps:10},i,{gradients:[],rails:[],tick:0,time:0,finalStanding:[]});var o=document.createElementNS(n,"g");o.setAttribute("id","gTrack");var s=document.createElementNS(n,"g");s.setAttribute("id","gCars"),e instanceof SVGElement&&(e.appendChild(o),e.appendChild(s)),Object.defineProperties(this,{simulation:{get:function get(){return r}},svg:{get:function get(){return e}},gTrack:{get:function get(){return o}},gCars:{get:function get(){return s}}}),Array.isArray(t)&&this.setTrack(t),Array.isArray(a)&&this.setCars(a)}r.fromJson=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return t instanceof SVGElement||(t=document.querySelector("svg")),new r(t,e.gradients.map(function(e){return new i(e)}),e.cars,{laps:e.laps})},Object.defineProperties(r.prototype,{init:{enumerable:!0,value:function value(){var _this4=this;if(!(this.svg instanceof SVGElement))throw new Error("RaceTrack.init requires valid svg element!");this.svg.getElementById("gTrack")||this.svg.appendChild(this.gTrack),this.svg.getElementById("gCars")||this.svg.appendChild(this.gCars),this.simulation.force("fCollide",d3.forceCollide(function(e){return e.radius}));var e=a(5);return this.simulation.force("fRailing",e(this.rails)),this.simulation.nodes().forEach(function(e,t){e.lapTimes=[],e.x=-7*(t+1),e.y=5*Math.pow(-1,t),e.vx=.9,e.vy=0,e.trackAhead=_this4.gradients.slice(),e.posn=[]}),this.moveCars(),this.listCars(),this.simulation.alphaDecay(0),this.simulation.velocityDecay(.01),this.simulation.on("tick",function(){_this4.onTick()}),this}},onTick:{value:function value(){var _this5=this;if(this.simulation.nodes(this.simulation.nodes()),requestAnimationFrame(function(e){_this5.time=e}),this.tick++,this.moveCars(),this.listCars(),this.cars.every(function(e){return e.lapTimes.length>_this5.laps})){this.simulation.stop(),this.cars.forEach(function(e){delete e.sphere});var _e7=document.createElement("a");_e7.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this)));var _t8=new Date;return _e7.setAttribute("download","race-".concat(_t8.getFullYear(),"-").concat(_t8.getMonth()+1,"-").concat(_t8.getDate(),".json")),_e7.innerText="Save race data",document.querySelector("form").appendChild(_e7),void buildReplay(this)}return this}},moveCars:{value:function value(){var _this6=this;return d3.selectAll("#gCars circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),this.simulation.nodes().forEach(function(e,t,a){if(e.nextPiece){var _t9=_this6.gradients.indexOf(e.trackAhead[0]);if(!e.time.some(function(a){return a.lap===e.lapTimes.length&&a.piece===_t9})&&(e.time.push({lap:e.lapTimes.length,piece:_t9,tick:_this6.tick,time:_this6.time}),0===_t9)){if(!_this6.finalStanding.includes(e.name)){e.time.slice(-1).pop();e.lapTimes.push({tick:_this6.tick,time:_this6.time})}e.lapTimes.length>_this6.laps&&(_this6.finalStanding.includes(e.name)||_this6.finalStanding.push(e.name))}e.trackAhead.push(e.trackAhead.shift()),e.nextPiece=!1}if(e.previousPiece&&(e.trackAhead.unshift(e.trackAhead.pop()),e.previousPiece=!1),_this6.finalStanding.includes(e.name)){var _t10=_this6.finalStanding.indexOf(e.name);e.y=Math.min(Math.max(-20,e.y),20),e.x>_this6.gradients[0].x+10*(_this6.cars.length-_t10)&&(e.fx=e.x,e.fy=e.y)}(e.x<_this6.extrema[0][0]-10||e.x>_this6.extrema[0][1]+10||e.y<_this6.extrema[1][0]-10||e.y>_this6.extrema[1][1]+10)&&_this6.simulation.stop()}),this.cars.forEach(function(e){e.posn.push({tick:_this6.tick,time:_this6.time,vx:e.vx,vy:e.vy,x:e.x,y:e.y})}),this}},setTrack:{enumerable:!0,value:function value(e){var _this7=this;this.gradients=e.filter(function(e){return e instanceof i});var t=[0,0];var a=[[0,0],[0,0]],r=[[],[]];this.rails=new Array(2).fill({});var o=[];this.gTrack.innerHTML="",this.gradients.forEach(function(e,i){t[0]+=e.delta[0],t[1]+=e.delta[1],o.push([t[0],t[1]]),e.x=t[0],e.y=t[1],e.force&&_this7.simulation.force("piece"+i,e.force);var s=Math.acos(e.gradient[0]/Math.hypot.apply(Math,_toConsumableArray(e.gradient)));e.gradient[1]<0&&(s=2*Math.PI-s);var c={x1:t[0]+e.width*Math.sin(s),y1:t[1]-e.width*Math.cos(s),x2:t[0]-e.width*Math.sin(s),y2:t[1]+e.width*Math.cos(s)};e.m=(c.y2-c.y1)/(c.x2-c.x1),e.b=-e.m*c.x1+c.y1;var l=document.createElementNS(n,"line");r[0].push({before:[c.x1-e.width*Math.cos(s)*e.rail[0],c.y1-e.width*Math.sin(s)*e.rail[0]],is:[c.x1,c.y1],after:[c.x1+e.width*Math.cos(s)*e.rail[0],c.y1+e.width*Math.sin(s)*e.rail[0]]}),r[1].push({before:[c.x2-e.width*Math.cos(s)*e.rail[1],c.y2-e.width*Math.sin(s)*e.rail[1]],is:[c.x2,c.y2],after:[c.x2+e.width*Math.cos(s)*e.rail[1],c.y2+e.width*Math.sin(s)*e.rail[1]]}),a[0][0]=Math.min(a[0][0],c.x1,c.x2),a[0][1]=Math.max(a[0][1],c.x1,c.x2),a[1][0]=Math.min(a[1][0],c.y1,c.y2),a[1][1]=Math.max(a[1][1],c.y1,c.y2),Object.entries(c).forEach(function(_ref13){var _ref14=_slicedToArray(_ref13,2),e=_ref14[0],t=_ref14[1];l.setAttribute(e,t)}),l.classList.add("checkpoint"),0===i&&l.classList.add("start-line"),_this7.gTrack.appendChild(l),d3.select("svg #gTrack").append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",0===i?1.5:2).attr("fill",e.color||"whitesmoke").attr("strokeWidth",0===i?"0.5px":"0").attr("stroke",0===i?"white":"none")}),this.extrema=a,r.forEach(function(e,t){e.push(e[0]);var a=document.createElementNS(n,"path"),i=[];e.forEach(function(t,a){0===a?i.push("M"+t.is.join(",")):i.push("C"+[e[a-1].after.join(" "),t.before.join(" "),t.is.join(" ")].join(","))}),a.setAttribute("d",i.join("")),_this7.gTrack.appendChild(a),_this7.rails[t]=a});var s=a[0][1]-a[0][0]+20,c=a[1][1]-a[1][0]+20,l=a[0][0]-10,d=a[1][0]-10;return c>4*s/5?(s=5*c/4,l=(a[0][0]+a[0][1]-s)/2):(c=4*s/5,d=(a[1][0]+a[1][1]-c)/2),this.svg.setAttribute("viewBox","".concat(l," ").concat(d," ").concat(s," ").concat(c)),d3.select("svg").append("g").selectAll("path").data([o]).enter().append("path").attr("d",d3.line().curve(d3.curveBasisClosed)).classed("lane-line",!0),this}},setCars:{enumerable:!0,value:function value(e){return d3.select("svg #gCars").selectAll("circle").data(e).enter().append("circle").classed("car",!0).attr("fill",function(e){return e.color}).attr("stroke",function(e){return e.color2}).attr("stroke-width",function(e){return e.strokeWidth}).attr("r",function(e){return e.r}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),this.simulation.nodes(e),this.cars=e.slice(),this}},listCars:{enumerable:!0,value:function value(){var _this8=this;var e=[];var t=document.querySelector("ol#positions");return this.cars.slice().sort(function(e,t){return 0===e.time.length&&0===t.time.length?0:0===e.time.length?1:0===t.time.length||e.time.length>t.time.length?-1:e.time.length<t.time.length||e.time[e.time.length-1].time>t.time[t.time.length-1].time?1:e.time[e.time.length-1].time<t.time[t.time.length-1].time?-1:0}).forEach(function(a,n){if(!(a.elPositionList instanceof Element)){a.elPositionList=document.createElement("li");var _e8=document.createElement("span");_e8.classList.add("name"),_e8.innerText=a.name,a.elPositionList.appendChild(_e8);var _t11=document.createElement("span");_t11.classList.add("time"),a.elPositionList.appendChild(_t11)}var i=a.elPositionList;if(a.time.length>1){var _t12=a.time.slice().pop();0===n&&(e=a.time.slice());var _r=i.querySelector(".time");if(0===n){var _e9=((_t12.time-a.time[0].time)/1e3).toFixed(2);_r.innerText!==_e9&&(_r.innerText=_e9),_r.classList.remove("fade-out")}else{var _n5=e.filter(function(e){return e.lap===_t12.lap&&e.piece===_t12.piece}).sort(function(e,t){return e.time-t.time})[0];_t12||console.error("lastTime:",_t12),_n5||console.error("leadTime:",_n5);var _i4=(_t12.time-_n5.time)/1e3;_i4=_i4>0?"+"+_i4.toFixed(2):_i4.toFixed(2),_r.innerText!==_i4&&(_r.classList.remove("fade-out"),a.lapTimes.length<_this8.laps&&setTimeout(function(){_r.classList.add("fade-out")},1e3),_r.innerText=_i4)}}i.style.order=n,i.setAttribute("order",n+1),t.contains(i)||t.appendChild(i)}),this}}}),e.exports=r},function(e,t){e.exports=function(e){var t=[];function a(a){e.forEach(function(e){t.forEach(function(t){var a=function(e,t){var a=[t.x+t.vx,t.y+t.vy],n=function n(e){return Math.hypot(e.x-a[0],e.y-a[1])},i=e.getTotalLength();var r,o,s,c=16,l=Number.POSITIVE_INFINITY;for(var _t13=0;_t13<=i;_t13+=c){var _a7=e.getPointAtLength(_t13),_i5=n(_a7);_i5<l&&(r=_a7,o=_t13,l=_i5)}if(l>=2*t.radius&&l>=Math.hypot(t.vx,t.vy))return{distance:l};c/=2;for(;c>.5;){var _t14=o-c,_a8=e.getPointAtLength(_t14),d=n(_a8),h=o+c;s=e.getPointAtLength(h);var m=n(s);_t14>=0&&d<l?(r=_a8,o=_t14,l=d):h<=i&&m<l?(r=s,o=h,l=m):c/=2}return{distance:l,after:s,best:r}}(e,t);if(a.distance<=t.radius||a.distance<=Math.hypot(t.vx/2,t.vy/2)){var _e10=[a.after.y-a.best.y,a.best.x-a.after.x];var n=Math.hypot.apply(Math,_toConsumableArray(_e10));_e10=_e10.map(function(e){return e/n});var i=[t.x-a.best.x,t.y-a.best.y];Math.acos((i[0]*_e10[0]+i[1]*_e10[1])/Math.hypot.apply(Math,i))>=Math.PI/2&&(_e10[0]=-_e10[0],_e10[1]=-_e10[1]);var r=t.vx*_e10[0]+t.vy*_e10[1];if(Math.acos(r/Math.hypot(t.vx,t.vy))<Math.PI/2)return;var o=Math.random()+1,s=[],c=0;do{o+=.05,s=[o*r*_e10[0],o*r*_e10[1]],c=Math.hypot(t.x+t.vx-s[0]-a.after.x,t.y+t.vy-s[1]-a.after.y)}while(Math.abs((t.vx-s[0])*_e10[0]+(t.vy-s[1])*_e10[1])<=Math.abs(r)&&c<t.radius&&o<3);if(o<2){var _a9=[-_e10[1],_e10[0]];Math.acos((t.vx*_a9[0]+t.vy*_a9[1])/Math.hypot(t.vx,t.vy))>Math.PI/2&&(_a9[0]*=-1,_a9[1]*=-1);var _n6=t.vx*_a9[0]+t.vy*_a9[1];for(o=.1;Math.hypot(t.vx-s[0],t.vy-s[1])<.6*Math.hypot(t.vx,t.vy)&&o<1;){o+=.1,s[0]-=.1*_n6*_a9[0],s[1]-=.1*_n6*_a9[1]}for(;Math.hypot(t.vx-s[0],t.vy-s[1])>Math.hypot(t.vx,t.vy);){s[0]+=.05*_n6*_a9[0],s[1]+=.05*_n6*_a9[1]}}t.vx-=s[0],t.vy-=s[1]}})})}return a.initialize=function(e){t=e},a}},function(e,t){function a(e){var _this9=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Object.assign(this,{strokeWidth:1,r:4},t,{trackAhead:[],nextPiece:!1,previousPiece:!1,lapTimes:[],time:[],posn:[]}),Object.defineProperties(this,{name:{enumerable:!0,get:function get(){return e}},radius:{enumerable:!0,get:function get(){return _this9.r+_this9.strokeWidth/2}}})}Object.defineProperties(a.prototype,{}),e.exports=a}]);