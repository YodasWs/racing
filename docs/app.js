"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t){i.d(n,r,function(e){return t[e]}.bind(null,r))}return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e){var i="http://www.w3.org/2000/svg";function n(t){this.gradient=t.gradient||[1,0],this.delta=t.delta||[0,0],this.width=t.width||20,this.right=t.right||!1,this.left=t.left||!1,this.up=t.up||!1,this.fx=d3.forceX().x(function(t,e){return 10}).strength(.001),this.fy=d3.forceY().y(function(t,e){return 10}).strength(.001)}function r(t,e,n){var r=d3.forceSimulation();this.gradients=[];var a=document.createElementNS(i,"g");a.setAttribute("id","gTrack");var s=document.createElementNS(i,"g");s.setAttribute("id","gCars"),t instanceof SVGElement&&(t.appendChild(a),t.appendChild(s)),Object.defineProperties(this,{simulation:{get:function get(){return r}},svg:{get:function get(){return t}},gTrack:{get:function get(){return a}},gCars:{get:function get(){return s}}}),e instanceof Array&&this.setTrack(e),n instanceof Array&&this.setCars(n)}function a(t,e){var n=document.createElementNS(i,"circle");n.classList.add("car"),"string"==typeof e.color&&n.setAttribute("fill",e.color),"string"==typeof e.color2&&(n.setAttribute("stroke-width","0.5px"),n.setAttribute("stroke",e.color2)),Object.defineProperties(this,{name:{enumerable:!0,get:function get(){return t}},ele:{get:function get(){return n}}}),this.fCollide=d3.forceCollide(4)}yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",function(){var t=document.querySelector("svg#scene"),e=new a("Alice",{color:"lightgreen",color2:"orange"}),i=new r(t,[{gradient:[1,0],delta:[0,0],width:20},{gradient:[1,0],delta:[20,0],width:20},{gradient:[1,1],delta:[27,13],width:20},{gradient:[0,1],delta:[13,27],width:20},{gradient:[-1,1],delta:[-13,27],width:20},{gradient:[-1,0],delta:[-27,13],width:20},{gradient:[-1,0],delta:[-120,0],width:20},{gradient:[-1,-1],delta:[-27,-13],width:20,right:!0},{gradient:[0,-1],delta:[-13,-27],width:20,up:!0},{gradient:[1,-1],delta:[13,-27],width:20,left:!0},{gradient:[1,0],delta:[27,-13],width:20}].map(function(t){return new n(t)}),[e]);console.log("Sam, raceTrack:",i),console.log("Sam, nodes:",i.simulation.nodes()),i.simulation.stop(),document.getElementById("btnStart").addEventListener("click",function(){console.log("Sam, start!"),i.simulation.stop(),i.init(),i.simulation.alpha(1),setTimeout(function(){i.simulation.restart()},500)})}),Object.defineProperties(r.prototype,{init:{enumerable:!0,value:function value(){var _this=this;if(!(this.svg instanceof SVGElement))throw new Error("RaceTrack.init requires valid svg element!");return this.svg.getElementById("gTrack")||this.svg.appendChild(this.gTrack),this.svg.getElementById("gCars")||this.svg.appendChild(this.gCars),console.log("Sam, simulation:",this.simulation),this.simulation.nodes().forEach(function(t){t.x=0,t.y=0,t.vx=0,t.vy=0}),this.moveCars(),this.simulation.on("tick",function(){_this.moveCars()}),this}},moveCars:{value:function value(){this.simulation.nodes().forEach(function(t){t.ele.setAttribute("cx",t.x),t.ele.setAttribute("cy",t.y)})}},setTrack:{enumerable:!0,value:function value(t){var _this2=this;this.gradients=[],t.forEach(function(t,e){t instanceof n&&(_this2.simulation.force("piece".concat(e,"x"),t.fx).force("piece".concat(e,"y"),t.fy),_this2.gradients.push(t))});var e=[0,0];var r=[[0,0],[0,0]],a=[[],[]];this.gTrack.innerHTML="",this.gradients.forEach(function(t,n){e[0]+=t.delta[0],e[1]+=t.delta[1];var s=Math.acos(t.gradient[0]/Math.hypot.apply(Math,_toConsumableArray(t.gradient)));t.left&&(s-=Math.PI/2),t.right&&(s+=Math.PI/2),t.up&&(s+=Math.PI);var o={x1:e[0]+t.width*Math.sin(s),y1:e[1]-t.width*Math.cos(s),x2:e[0]-t.width*Math.sin(s),y2:e[1]+t.width*Math.cos(s)},l=document.createElementNS(i,"line");a[0].push([o.x1,o.y1]),a[1].push([o.x2,o.y2]),r[0][0]=Math.min(r[0][0],o.x1,o.x2),r[0][1]=Math.max(r[0][1],o.x1,o.x2),r[1][0]=Math.min(r[1][0],o.y1,o.y2),r[1][1]=Math.max(r[1][1],o.y1,o.y2),Object.entries(o).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),t=_ref2[0],e=_ref2[1];l.setAttribute(t,e)}),l.classList.add("checkpoint"),0===n&&l.classList.add("start-line"),_this2.gTrack.appendChild(l)}),a.forEach(function(t){t.push(t[0]);var e=document.createElementNS(i,"path"),n=[];t.forEach(function(t){n.push(t.join(","))}),e.setAttribute("d","M"+n.join("L")),_this2.gTrack.appendChild(e)});var s=r[0][1]-r[0][0]+20,o=r[1][1]-r[1][0]+20,l=r[0][0]-10,d=r[1][0]-10;return s>o?(o=4*s/5,d=(r[1][0]+r[1][1]-o)/2):(s=5*o/4,l=(r[0][0]+r[0][1]-o)/2),this.svg.setAttribute("viewBox","".concat(l," ").concat(d," ").concat(s," ").concat(o)),this}},setCars:{enumerable:!0,value:function value(t){var _this3=this;return t.forEach(function(t,e){console.log("Sam, car:",t),t.addToSVG(_this3.svg),_this3.simulation.force("car".concat(e,"fcollide"),t.fCollide)}),this.simulation.nodes(t),this}}}),Object.defineProperties(a.prototype,{addToSVG:{enumerable:!0,value:function value(t){return t.getElementById("gCars").appendChild(this.ele),this}}})}]);