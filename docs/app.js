"use strict";(()=>{"use strict";yodasws.page("pageRenderer").setRoute({title:"Renderer",template:"pages/Renderer/Renderer.html",canonicalRoute:"/Renderer/",route:"/Renderer/?"}).on("load",()=>{let e,t;document.querySelector("input[type=\"file\"][name=\"race\"]").addEventListener("change",a=>{const r=a.target.files[0];if("application/json"!==r.type)return void a.preventDefault();const i=new FileReader;i.onload=a=>{const r=JSON.parse(a.target.result),i=document.createElement("svg");if(e=RaceTrack.fromJson(r,i),e.simulation.stop(),t instanceof Environment){n(e,t);const a=document.querySelector("form #btnExport");a instanceof HTMLElement&&a.removeAttribute("disabled")}},i.readAsText(r)}),document.querySelector("input[type=\"file\"][name=\"environment\"]").addEventListener("change",a=>{const r=a.target.files[0];if("application/json"!==r.type)return void a.preventDefault();const i=new FileReader;i.onload=a=>{const r=JSON.parse(a.target.result);if(t=Environment.fromJson(r),e instanceof RaceTrack){n(e,t);const a=document.querySelector("form #btnExport");a instanceof HTMLElement&&a.removeAttribute("disabled")}},i.readAsText(r)})});const e=(()=>{const e=new EventTarget,t=new Set;let a;return e.addφListener=(a,n)=>{t.add(a),e.addEventListener("\u03C6Change",e=>{e.detail.φ===a&&n(e)})},e.φChange=(n,r)=>{t.forEach(t=>{a<=t&&t<n&&e.dispatchEvent(new CustomEvent("\u03C6Change",{detail:{φ:t}}))}),a=n},e})(),t=(()=>{const t={setφToActivateCamera:{value(t){e.addφListener(t,e=>{scene.activeCamera=this})}}};return new Proxy(function(e="",t=[],{φRange:a=[-Math.PI/2,3*Math.PI/2]}={}){this.φRange=a,this.uuid=Math.floor(1e3*Math.random()).toString().padStart(3,"0")},{construct(e,a){const[n,r]=a,i=BABYLON[n];if(!i)throw new TypeError(`Unknown camera type '${n}'`);if(!(i.prototype instanceof BABYLON.TargetCamera))throw new TypeError(`Invalid camera type '${n}'`);const o=Object.create(i.prototype);return i.apply(o,r),e.apply(o,a),Object.defineProperties(o.__proto__,t),o}})})();let a;function n(r,{OverheadCirclingSpeed:i=5,filmCountdownOnly:o=!1,doExport:l=!1,targetFrameRate:c=30,renderFrameRate:s=30}={}){clearInterval(a);const{AbstractMesh:d,Animation:m,AnimationGroup:h,Color3:p,Color4:u,DirectionalLight:w,Engine:g,FollowCamera:f,Mesh:T,MeshBuilder:E,Scene:C,SkyMaterial:v,StandardMaterial:A,Texture:b,UniversalCamera:O,Vector3:M,GUI:I,GrassProceduralTexture:L,DynamicTerrain:N}=BABYLON,R=document.querySelector("canvas#replay"),S=new g(R,!0),P=new C(S);P.useRightHandedSystem=!0,P.ambientColor=new p(.8,.8,.8);const k={cross:Math.max(Math.abs(r.extrema[x][1]-r.extrema[x][0]),Math.abs(r.extrema[y][1]-r.extrema[y][0])),height:r.extrema[y][1]-r.extrema[y][0],width:r.extrema[x][1]-r.extrema[x][0],midpoint:new M((r.extrema[x][0]+r.extrema[x][1])/2,0,(r.extrema[y][0]+r.extrema[y][1])/2)};Object.entries({sPosition:{get(){const e=[this.position.x-k.midpoint.x,this.position.y-k.midpoint.y,this.position.z-k.midpoint.z],t=Math.hypot(...e);return{r:t,φ:0===e[x]?0:Math.atan(e[z]/e[x])+(e[x]<0?Math.PI:0),θ:0===e[y]?0:Math.acos(Math.hypot(e[x]/t,e[z]/t)/e[y]/t)}},set(...e){const[t,a,n]=Array.isArray(e[0])?e[0]:e;this.position=new M(t*Math.sin(n)*Math.cos(a)+k.midpoint.x,t*Math.sin(n)*Math.sin(a)+k.midpoint.z,t*Math.cos(n)+k.midpoint.y)}}}).forEach(([e,t])=>{[BABYLON.TransformNode.prototype,BABYLON.Camera.prototype].forEach(a=>{a.hasOwnProperty(e)||Object.defineProperty(a,e,t)})});const _=new v("sky",P);_.backFaceCulling=!1,_.luminance=.2,_.useSunPosition=!0,_.sunPosition=new M(10,3,1),_.turbidity=2,_.rayleigh=3,_.cameraOffset.y=200;const G=T.CreateSphere("skyBox",5,2*k.cross,P);G.material=_,G.position=k.midpoint;const F=new w("light2",_.sunPosition.negate(),P);F.diffuse=new p(1,1,1),F.intensity=.5;const B=[new t("UniversalCamera",["cameraTopLeftCorner",new M(r.extrema[x][0],20,r.extrema[y][0]-30),P],{φRange:[150*Math.PI/180,5*Math.PI/4]}),new t("UniversalCamera",["cameraOverheadCenter",new M(-35,160,2*r.extrema[y][1]),P]),new t("UniversalCamera",["cameraTopRightCorner",new M(r.extrema[x][1]+10,20,r.extrema[y][0]-10),P],{φRange:[-Math.PI/2,10*Math.PI/180]}),new t("UniversalCamera",["cameraBackMidfield",new M(-50,50,r.extrema[y][1]+70),P],{φRange:[0*Math.PI/180,125*Math.PI/180]}),new t("UniversalCamera",["cameraCircling",new M(r.extrema[x][0]+200,20,r.extrema[y][0]-10),P])];B.find(e=>"cameraTopRightCorner"===e.id).setφToActivateCamera(0);const H=new A("grass",P);H.ambientColor=new p(127/255,229/255,112/255),H.ambientTexture=new L("grassPT",256,P),H.specularColor=new p(80/255,80/255,80/255);const V=new A("asphalt",P);V.ambientColor=new p(183/255,181/255,186/255),V.specularColor=new p(96/255,96/255,96/255);const D=new L("asphaltPT",256,P);D.grassColors=[new p(183/255,181/255,186/255),new p(135/255,133/255,138/255),new p(151/255,149/255,154/255)],V.ambientTexture=D;const U=new A("black",P);U.diffuseColor=new p(1/255,1/255,1/255),U.ambientColor=new p(1/255,1/255,1/255);const $=new A("trackSiding",P);$.diffuseColor=new p(235/255,88/255,99/255),$.ambientColor=new p(235/255,88/255,99/255),$.specularColor=new p(160/255,160/255,160/255);const j=(()=>{const e=200,t=new Float32Array(12e4);for(let a=0;a<200;a++)for(let n=0;n<e;n++){const r=[5*(n-100),-.05,5*(a-100)];t[3*(a*e+n)+x]=r[x],t[3*(a*e+n)+y]=r[y],t[3*(a*e+n)+z]=r[z]}const a=new N("dtGround",{mapData:t,mapSubX:e,mapSubZ:200,terrainSub:60},P);return a.updateCameraLOD=e=>Math.abs(e.globalPosition.y/10|0),a.mesh.material=H,a.isAlwaysVisible=!0,a})();((e={})=>{const{trackEdge:t=-20,sideHeight:a=2,front:n=-50,back:r=-150,left:i=-100,right:o=100,height:l=50}=e,c=E.CreateRibbon("stands",{closePath:!1,pathArray:[[new M(o,-.03,t),new M(o,-.03,n),new M(o,l,r)],[new M(i,-.03,t),new M(i,-.03,n),new M(i,l,r)]]},P),s=new A("crowd",P);s.ambientColor=new p(170/255,170/255,170/255),s.specularColor=new p(64/255,64/255,64/255);const d=new L("crowdPT",256,P);d.grassColors=[new p(165/255,165/255,215/255),new p(215/255,165/255,170/255),new p(165/255,215/255,165/255)],s.ambientTexture=d,c.material=s;const m=E.CreateRibbon("standsSides",{sideOrientation:T.DOUBLESIDE,closePath:!1,pathArray:[[new M(o,-.03,t),new M(o,-.03,n),new M(o,-.03,r),new M(o,-.03,r),new M(i,-.03,r),new M(i,-.03,r),new M(i,-.03,n),new M(i,-.03,t)],[new M(o,-.03+a,t),new M(o,-.03+a,n),new M(o,l+a,r),new M(o,l+a,r),new M(i,l+a,r),new M(i,l+a,r),new M(i,-.03+a,n),new M(i,-.03+a,t)]]},P),h=new A("standsSiding",P);h.diffuseColor=new p(99/255,99/255,99/255),h.ambientColor=new p(131/255,131/255,131/255),h.specularColor=new p(208/255,208/255,208/255),m.material=h})(r.grandStand),(()=>{const e=[],t=new m("spinningCamera","position",s,m.ANIMATIONTYPE_VECTOR3,m.ANIMATIONLOOPMODE_CYCLE),[a,n]=k.height<k.width?[.7*k.width,1*k.height]:[k.width*(.5+1/6),k.height*(.5+1/6)];for(let t=0;t<360;t++)e.push({frame:Math.floor(t*i),value:new M(Math.cos((180+t)*Math.PI/180)*a+k.midpoint.x,100,Math.sin((180+t)*Math.PI/180)*n+k.midpoint.z)});t.setKeys(e);const o=new h("animeFlyover");o.normalize(0,e[e.length-1].frame);const l=r.cars.slice(0,3),c=new M(l.reduce((e,t)=>e+t.posn[0].x,0)/l.length,l.reduce((e,t)=>e+t.radius,0)/l.length,l.reduce((e,t)=>e+t.posn[0].y,0)/l.length);B.filter(e=>"cameraCircling"===e.id).forEach(e=>{e.lockedTarget=c,o.addTargetedAnimation(t,e)}),o.play(!0)})();const Y=[[],[]],Z=[[],[]];r.rails.forEach((e,t)=>{const a=e.getTotalLength();for(let n=0;n<100;n+=.2){const r=e.getPointAtLength(a*n/100);Y[t].push(new M(r.x,0,r.y)),Z[t].push(new M(r.x,5,r.y))}}),Z.forEach((e,t)=>{const a=[e,Y[t]];E.CreateRibbon(`rail${t}`,{sideOrientation:T.DOUBLESIDE,pathArray:a,closePath:!0},P).material=$}),E.CreateRibbon("track",{pathArray:Y.reverse(),closePath:!0},P).material=V;const q=r.gradients[0];E.CreateLines("startLine",{points:[new M(q.x-q.width*Math.sin(q.α),.02,q.y+q.width*Math.cos(q.α)),new M(q.x+q.width*Math.sin(q.α),.02,q.y-q.width*Math.cos(q.α))],colors:new Array(2).fill(new u(0,0,0,1)),useVertexAlpha:!1},P).material=U;const J=r.cars.slice();J.forEach(e=>{const t=e.posn[0];if(e.sphere=E.CreateSphere(`sphere${e.name}`,{segments:16,diameter:2*e.radius},P),e.sphere.position=new M(t.x,e.radius,t.y),Array.isArray(e.rgb)){const t=new A(`${e.name}Material`,P);t.diffuseColor=new p(...e.rgb.map(e=>e/255)),t.ambientColor=new p(...e.rgb.map(e=>e/255)),t.diffuseTexture=new b("ball.png",P),e.sphere.material=t}});let W=7;const K=l?m.ANIMATIONLOOPMODE_CONSTANT:m.ANIMATIONLOOPMODE_CYCLE;let X;const Q={flyover:{playTime:o?1:20,nextStage:"countdown",loopAnimes:!0,camera:B.find(e=>"cameraCircling"===e.id),cameras:B},countdown:{animes:new h("animeCountdown"),camera:B.find(e=>"cameraOverheadCenter"===e.id),nextStage:"race",playTime:3.5},race:{animes:new h("animeRace"),secondsToSwitchCameras:5,rotateCamera:!0,cameras:B,nextStage:"afterRace"},afterRace:{secondsToSwitchCameras:2.5,rotateCamera:!0,playTime:20,cameras:B}};Q.events=new EventTarget,Q.events.addEventListener("start",function(e){X=e.detail;const t=Q[X];if(!t)throw Error(`Could not find stage ${X}`);"string"==typeof t.camera?P.activeCamera=B.find(e=>e.id===t.camera):t.camera instanceof BABYLON.TargetCamera&&(P.activeCamera=t.camera),"function"==typeof t.onStartStage&&t.onStartStage(),t.animes instanceof h&&t.animes.play(!!t.loopAnimes),Number.isFinite(t.playTime)&&t.playTime>0&&setTimeout(()=>{this.dispatchEvent(new CustomEvent("end",{detail:X}))},1e3*t.playTime*c/s)}),Q.events.addEventListener("end",function(e){const t=e.detail;if(Q[t]){const e=Q[t];"function"==typeof e.onEndStage&&e.onEndStage(),e.nextStage&&Q[e.nextStage]&&this.dispatchEvent(new CustomEvent("start",{detail:e.nextStage})),e.overlay&&e.overlay.autoDispose&&e.overlay.dispose()}}),Q.flyover,(e=>{const{AdvancedDynamicTexture:t,Control:a,Rectangle:n,TextBlock:r}=I,i=new t.CreateFullscreenUI("myUI");i.useInvalidateRectOptimization=!1,i.renderScale=2,e.overlay=i;const o=new n;o.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,o.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,o.background="white",o.height="0.1",o.width="0.25",o.paddingLeft="20%",o.clipChildren=!1,o.clipContent=!1,o.cornerRadius=100;const l=new r;l.fontSize=100,l.fontWeight="bold",l.color="black",l.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,l.textVerticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,l.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,o.addControl(l);let d,m=3;const h=()=>{3===m&&i.addControl(o),l.text=m>0?m.toString():"Go!",m--};e.onStartStage=()=>{setTimeout(()=>{h(),d=setInterval(h,1e3*c/s)},500*c/s)},e.onEndStage=()=>{d&&(h(),clearInterval(d)),setTimeout(()=>{i.removeControl(o),i.dispose()},1e3*c/s)}})(Q.countdown);const ee=(e,t)=>t.tick-e.tick,te=(e=>{let t=[];const a=()=>{t=e.map(e=>({name:e.name,radius:e.radius,lenTime:e.time.length,time:e.time.slice().sort(ee),posn:e.posn.slice().sort(ee)}))};a();const n=e=>(t.forEach(t=>{t.curTime=t.time.find(t=>t.tick<=e),t.curPosn=t.posn.find(t=>t.tick<=e)}),t.sort((e,t)=>{if(0===e.lenTime&&0===t.lenTime)return 0;if(0===e.lenTime)return 1;if(0===t.lenTime)return-1;if(void 0===e.curTime&&void 0===t.curTime)return 0;if(void 0===e.curTime)return 1;if(void 0===t.curTime)return-1;if(e.curTime.lap<t.curTime.lap)return 1;if(e.curTime.lap>t.curTime.lap)return-1;if(e.curTime.piece!==t.curTime.piece){if(0===e.curTime.piece)return-1;if(0===t.curTime.piece)return 1;if(e.curTime.piece<t.curTime.piece)return 1;if(e.curTime.piece>t.curTime.piece)return-1}return e.curTime.tick<t.curTime.tick?-1:e.curTime.tick>t.curTime.tick?1:0}),t);return n.reset=a,n})(J);let ae;if(J[0].posn.length>1){let e=0;const t=2*Math.PI;if(J.forEach(a=>{let n=0,r=0;const i=[],o=[new m(`moveAnime${a.name}`,"position",s,m.ANIMATIONTYPE_VECTOR3,K),new m(`spinAnime${a.name}`,"rotation",s,m.ANIMATIONTYPE_VECTOR3,K)];o.forEach(e=>i.push([])),a.posn.forEach(o=>{const l=3*o.tick;i[0].push({frame:l,value:new M(o.x,a.radius,o.y)});const c=Math.hypot(o.vx,o.vy);if(c>0){let e=-Math.sign(o.vy)*Math.acos(o.vx/c)%t-r%t;for(;Math.abs(e)>Math.PI;)e-=Math.sign(e)*t;r+=e,n-=c*Math.PI/16}i[1].push({frame:l,value:new M(0,r,n)}),e=Math.max(e,o.tick)}),W=i.reduce((e,t)=>Math.max(e,t[t.length-1].frame),W),o.forEach((e,t)=>{e.setKeys(i[t]),Q.race.animes.addTargetedAnimation(e,a.sphere)})}),!(document.querySelector("form #btnExport")instanceof HTMLElement)){const e=document.createElement("button");e.setAttribute("id","btnExport"),e.innerText="Export",e.addEventListener("click",()=>{e.setAttribute("disabled","disabled"),clearInterval(a),n(r,{OverheadCirclingSpeed:4,doExport:!0,targetFrameRate:60,renderFrameRate:2})});const t=document.querySelector("form");t instanceof Element&&t.appendChild(e)}(()=>{const t=[],a=[new m("cameraTrack","position",s,m.ANIMATIONTYPE_VECTOR3,K)];a.forEach(e=>t.push([]));for(let a=0;a<e;a++){const e=te(a).slice(0,3),n=[e.reduce((e,t)=>e+t.curPosn.x,0)/e.length,e.reduce((e,t)=>e+t.radius,0)/e.length,e.reduce((e,t)=>e+t.curPosn.y,0)/e.length];t[0].push({frame:3*a,value:new M(...n),φ:0===n[x]?0:Math.atan(n[z]/n[x])})}te.reset(),W=t.reduce((e,t)=>Math.max(e,t[t.length-1].frame),W),ae=new d("raceCameraTarget",P),ae.position=t[0][0].value,Q.race.cameras.forEach(e=>e.lockedTarget=ae),B.filter(e=>"cameraCircling"===e.id).forEach(e=>{e.lockedTarget=ae}),a.forEach((e,a)=>{e.setKeys(t[a]),Q.race.animes.addTargetedAnimation(e,ae)})})(),Q.race.animes.normalize(0,W)}else delete Q.flyover.nextStage,Q.flyover.cameras.forEach(e=>e.setTarget(new M(0,4.5,0)));const ne=(()=>{const{AdvancedDynamicTexture:e,Control:t,StackPanel:a,TextBlock:n,XmlLoader:i}=I,o=new e.CreateFullscreenUI("myUI");o.useInvalidateRectOptimization=!1,o.renderScale=2,Q.race.overlay=o,Q.race.overlay.autoDispose=!0;const l=new a;l.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,l.verticalAlignment=t.VERTICAL_ALIGNMENT_TOP,l.background="white",l.width="0.14",l.top="0",l.left="0",l.clipChildren=!1,l.clipContent=!1,Q.events.addEventListener("start",function(e){"flyover"===e.detail&&o.addControl(l)});const c=new a;c.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,c.verticalAlignment=t.VERTICAL_ALIGNMENT_BOTTOM,c.background="white",c.width="0.1",c.clipChildren=!1,c.clipContent=!1;const s=new n;s.fontSize=70,s.height="110px",s.color="black",s.paddingLeft="20px",s.paddingBottom="20px",s.paddingTop="20px",s.textHorizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,s.textVerticalAlignment=t.VERTICAL_ALIGNMENT_BOTTOM,c.addControl(s);const d=new Array(J.length).fill(0).map((e,a)=>{const r=new n;return r.fontSize=70,r.color="black",r.paddingLeft="10px",r.height="90px",0===a&&(r.paddingTop="20px",r.height="110px"),r.textHorizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,r.textVerticalAlignment=t.VERTICAL_ALIGNMENT_TOP,l.addControl(r),r});return function(e){te(e).forEach((e,t)=>{0===t&&e.curTime&&(o.addControl(c),e.curTime.lap>r.laps?s.text="Finish!":e.curTime.lap>0?s.text=`Lap ${e.curTime.lap} / ${r.laps}`:s.text="GO!"),d[t].text=`${t+1} ${e.name}`})}})();(e=>{const{AdvancedDynamicTexture:t,Control:a,StackPanel:n,TextBlock:r}=I,i=Q[e],o=new t.CreateFullscreenUI("myUI");o.useInvalidateRectOptimization=!1,o.renderScale=2,i.overlay=o;const l=new n;l.horizontalAlignment=a.HORIZONTAL_ALIGNMENT_RIGHT,l.verticalAlignment=a.VERTICAL_ALIGNMENT_CENTER,l.background="white",l.width="0.31",l.clipChildren=!1,l.clipContent=!1;const c=new Array(J.length).fill(0).map((e,t)=>{const n=new r;return n.fontSize=150,n.color="black",n.paddingLeft="10px",n.height=`${n.fontSize+30}px`,n.textHorizontalAlignment=a.HORIZONTAL_ALIGNMENT_LEFT,n.textVerticalAlignment=a.VERTICAL_ALIGNMENT_TOP,l.addControl(n),n});Q.events.addEventListener("start",function(t){t.detail===e&&o.addControl(l)}),i.overlay.render=()=>{const e=J.reduce((e,t)=>Math.max(e,t.lapTimes[t.lapTimes.length-1].tick),0);te(e).forEach((e,t)=>{c[t].text=`${t+1} ${e.name}`})}})("afterRace"),P.activeCamera=B[0];const re=(()=>{let e=1;return Q.race.animes.onAnimationGroupPlayObservable.add(()=>{e=0}),Q.race.animes.onAnimationGroupEndObservable.add(()=>{e=0}),{pickNextCamera:function(){!0===Q[X].rotateCamera&&oe%Q[X].framesToSwitchCameras===0&&(function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("newActiveCameraIndex must be a nonnegative integer");e=t,P.activeCamera=B[t%B.length]}(++e),e%B.length==0&&le++)}}})(),ie=(e=>e?new WebMWriter({quality:.95,frameRate:c}):{addFrame(){},complete:()=>Promise.reject()})(l);let oe=0,le=0;Object.entries(Q).forEach(([e,t])=>{Number.isFinite(t.secondsToSwitchCameras)&&(Q[e].framesToSwitchCameras=t.secondsToSwitchCameras*c)}),P.beforeRender=e=>{j.camera!==e.activeCamera&&(j.camera=e.activeCamera,j.camera.position.y<30&&(j.initialLOD=5))},P.afterRender=e=>{l&&("flyover"!==X||oe>5)&&ie.addFrame(R)},console.log("Sam, max number of frames:",W),Object.entries(Q).forEach(([e,t])=>{t.animes instanceof h&&("function"==typeof t.onStartAnimation&&t.animes.onAnimationGroupPlayObservable.add(t.onStartAnimation),t.animes.onAnimationGroupEndObservable.add(()=>{Q.events.dispatchEvent(new CustomEvent("end",{detail:e}))}))}),Q.race.animes.onAnimationGroupPlayObservable.add(()=>{X="race",oe=0,le=0}),Q.race.animes.onAnimationGroupEndObservable.add(()=>{X="afterRace",oe=0,le=0,W=Q.afterRace.playTime*c,Q.events.dispatchEvent(new CustomEvent("end",{detail:"race"}))}),a=setInterval(()=>{P.render(),["flyover","countdown"].includes(X)&&ne(0),Q.race.animes.isPlaying&&ne(oe/3),Q[X].overlay&&"function"==typeof Q[X].overlay.render&&Q[X].overlay.render(oe/3),re.pickNextCamera(),ae instanceof d&&e.φChange(ae.sPosition.φ),oe++,oe%20==0&&l&&console.log("Sam, frame",oe,",",(oe/c).toFixed(3),"seconds");let t=!1;o&&"race"===X&&oe>=1*c&&(t=!0),"afterRace"===X&&oe>=Q.afterRace.playTime*c&&(t=!0),t&&(console.log("Sam, at end of video!"),l||o?(clearInterval(a),console.log("Sam, done running WebGL animation"),ie.complete().then(e=>{const t=URL.createObjectURL(e),a=document.querySelector("main");if(a instanceof Element){const e=document.createElement("a");e.innerText="Open  in new window",e.setAttribute("target","_blank"),e.setAttribute("href",t),a.appendChild(e);const n=document.createElement("video"),r=document.createElement("source");r.setAttribute("type","video/webm"),r.setAttribute("src",t),n.appendChild(r),a.appendChild(n)}else window.open(t,"_blank")}).catch(e=>{console.error("Sam, videoWriter failed:",e)})):(te.reset(),Q.race.animes.play(!1)))},1e3/s),S.resize(),window.addEventListener("resize",()=>{S.resize()}),X||Q.events.dispatchEvent(new CustomEvent("start",{detail:"flyover"}))}const r=JSON.parse("{\"trackPieces\":[{\"gradient\":[1,0],\"delta\":[0,0],\"width\":20,\"color\":\"black\",\"flyoverPoint\":true},{\"gradient\":[1,0],\"delta\":[150,0],\"width\":20,\"rail\":[[0.5,1.75],[0.25,0.75]],\"flyoverPoint\":true},{\"gradient\":[1,2],\"delta\":[50,30],\"width\":20,\"rail\":[[1,1],[0.6,0.25]]},{\"gradient\":[1,2],\"delta\":[30,60],\"width\":20,\"rail\":[0.5,0.25]},{\"gradient\":[0,1],\"delta\":[8,30],\"width\":20,\"rail\":[[0.5,0.1],[0.25,0.1]]},{\"gradient\":[0,1],\"delta\":[0,20],\"width\":20,\"rail\":[[1.5,2.5],[0.125,0.75]],\"flyoverPoint\":true},{\"gradient\":[-1,0],\"delta\":[-50,50],\"width\":20,\"rail\":[[1.5,1.5],[1,0.125]]},{\"gradient\":[-5,-1],\"delta\":[-60,-10],\"width\":20,\"rail\":[[0.25,1.2],[0.25,2.5]]},{\"gradient\":[-2,3],\"delta\":[-70,40],\"width\":20,\"rail\":[[0.5,2],[0.75,1.5]]},{\"gradient\":[-3,-2],\"delta\":[-70,20],\"width\":20,\"rail\":[[2,0.5],[0.25,0.16667]],\"flyoverPoint\":true},{\"gradient\":[-3,-2],\"delta\":[-60,-40],\"width\":20,\"rail\":[[0.25,0.5],[1,2]]},{\"gradient\":[-2,3],\"delta\":[-70,10],\"width\":20,\"rail\":[[1,0.25],[1.5,0.1]]},{\"gradient\":[-2,3],\"delta\":[-10,15],\"width\":20,\"rail\":[[0.1,2],[0.1,1]]},{\"gradient\":[-3,-2],\"delta\":[-70,20],\"width\":20,\"rail\":[[1.5,0.25],[0.6,0.25]]},{\"gradient\":[-3,-2],\"delta\":[-60,-40],\"width\":20,\"rail\":[[0.25,1],[0.25,2]]},{\"gradient\":[-1,0],\"delta\":[-60,-25],\"width\":20,\"rail\":[[0.7,1],[1,2]]},{\"gradient\":[-1,1],\"delta\":[-55,20],\"width\":20,\"rail\":[[0.2,0.2],[0.75,1]]},{\"gradient\":[-1,0],\"delta\":[-70,40],\"width\":20,\"rail\":[[2,2.5],[1,1.5]],\"flyoverPoint\":true},{\"gradient\":[0,-1],\"delta\":[-80,-70],\"width\":20,\"rail\":[[3,1.2],[1.7,0.75]]},{\"gradient\":[0,-1],\"delta\":[0,-80],\"width\":20,\"rail\":[[1,3],[1,2]],\"color\":\"lightgreen\",\"flyoverPoint\":true},{\"gradient\":[1,0],\"delta\":[90,-90],\"width\":20,\"rail\":[[3,1],[2,1]],\"flyoverPoint\":true},{\"gradient\":[1,0],\"delta\":[90,0],\"width\":20},{\"gradient\":[1,0],\"delta\":[90,0],\"width\":20},{\"gradient\":[1,0],\"delta\":[90,0],\"width\":20},{\"gradient\":[1,0],\"delta\":[90,0],\"width\":20}],\"grandStand\":{\"trackEdge\":-20,\"sideHeight\":2,\"front\":-50,\"back\":-250,\"left\":-400,\"right\":100,\"height\":100}}"),i=JSON.parse("{\"trackPieces\":[{\"gradient\":[1,0],\"delta\":[0,0],\"width\":20,\"color\":\"black\"},{\"gradient\":[1,0],\"delta\":[20,0],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[1,1],\"delta\":[27,13],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[0,1],\"delta\":[13,27],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[-1,1],\"delta\":[-13,27],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[-1,0],\"delta\":[-27,13],\"width\":20,\"rail\":[1,0.25],\"color\":\"lightgreen\"},{\"gradient\":[-1,0],\"delta\":[-120,0],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[-1,-1],\"delta\":[-27,-13],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[0,-1],\"delta\":[-13,-27],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[1,-1],\"delta\":[13,-27],\"width\":20,\"rail\":[1,0.25]},{\"gradient\":[1,0],\"delta\":[27,-13],\"width\":20,\"rail\":[1,0.25]}],\"grandStand\":{\"trackEdge\":-20,\"sideHeight\":2,\"front\":-30,\"back\":-100,\"left\":-105,\"right\":25,\"height\":35}}");window.json={},json.cSuzuka=r,json.cOval=i,yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",()=>{})})();